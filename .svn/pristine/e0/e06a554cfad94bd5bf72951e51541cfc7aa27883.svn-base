<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>

<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1.0" name="viewport">
<title></title>
<meta name="description" content="">
<meta name="keywords" content="">
<link rel="stylesheet" href="/main/assets/css/card.css">
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<!-- Swiper CSS -->
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

<!-- Swiper JS -->
<script
	src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

</head>
<body>

	<!-- header.jsp 시작 -->
	<%@ include file="header.jsp"%>

	<sec:authorize access="isAuthenticated()">
		<sec:authentication property="principal.usersVO" var="userVO" />
	</sec:authorize>
	
	<div> <!-- 출력용 div -->
	<!-- 
			<p>가입한 아티스트 정보 + 굿즈 정보</p>
			${joinArtistGroupList }
			<p>새로운 아티스트</p>
			${newArtistGroupList }
			<p>디엠리스트 아티스트 정보</p>
			${dmList }
			<p>굿즈 정보</p>
			${goodsVOList}
			<p>사용자 정보 </p>
			${userVO}
	 -->
	</div>
	
	<c:if test="${not empty userVO}">
		<script>
			const userVO = {
					userNo : ${userVO.userNo}
			}
		</script>
	</c:if>

	

	<main class="main">
		<!-- 
		가입한 커뮤니티 리스트 (회원만)
		가입한 그룹 굿즈 리스트 (회원만)
		디엠 리스트 (회원 + 비회원)
		새로운 아티스트를 만나보세요 (회원+비회원) (회원은 가입하지 않은 그룹만, 비회원은 전체)
	 -->

		<!-- ///// 회원 관점 시작 ///// -->
		<sec:authorize access="isAuthenticated()">
		
			<!-- 나의 커뮤니티 시작 -->
			<c:if test="${joinArtistGroupList[0] != null }">
				<div class="grayBackground">
					<div class="container py-5">
						<h5 class="text fw-bold mb-4">
							<spring:message code="home.my.community" />
						</h5>
						<div class="d-flex flex-wrap justify-content-start"
							style="gap: 35px;">
							<!-- 가입한 커뮤니티 리스트 시작 -->
							<c:forEach var="artGroup" items="${joinArtistGroupList}">
								<c:set var="groupFile"
									value="${artGroup.fileGroupVO.fileDetailVOList[0]}" />
								<form action="/oho/community/fanBoardList" method="get">
									<input type="hidden" name="artGroupNo" value="${artGroup.artGroupNo}" />
									<input type="hidden" name="memNo" value="${userVO.userNo}">
									<button class="card-artist">
										<!-- 그룹 대표 이미지 -->
										<img src="/upload${groupFile.fileSaveLocate}" class="bg-img">
										<!-- 그룹 로고 -->
										<div class="logo-wrap">
											<img src="/upload${artGroup.fileLogoSaveLocate}">
										</div>
										<!-- 그룹 명 -->
										<div class="card-body">
											<h6>${artGroup.artGroupNm}</h6>
										</div>
									</button>
								</form>
							</c:forEach>
							<!-- 가입한 커뮤니티 리스트 끝 -->
						</div>
					</div>
				</div>
			</c:if>
			<!-- 나의 커뮤니티 끝 -->

			<!-- 구독한 그룹의 굿즈샵 시작 -->
			<c:if test="${joinArtistGroupList[0] != null }">
				<div class="container py-5">
					<h5 class="text fw-bold mb-4">
						<spring:message code="home.merch" />
					</h5>
					<div class="d-flex flex-wrap justify-content-start" style="gap: 16px;">
						<button class="card-artistNm active"><spring:message code="home.goods.all" /></button>
						<c:forEach var="artGroup" items="${joinArtistGroupList}">
							<c:if test="${artGroup.goodsVOList[0].gdsNo != 0}">
								<button class="card-artistNm" data-group="${artGroup.artGroupNo}">${artGroup.artGroupNm}</button>
							</c:if>
						</c:forEach>
					</div>
				</div>
				<!-- 굿즈 리스트 (캐러셀) 시작 -->
				<div class="container">
					<div class="swiper mySwiper">
						<div id="goodsListContainer" class="swiper-wrapper">
							<c:forEach var="artGroup" items="${goodsVOList}">
								<c:forEach var="goods" items="${artGroup.goodsVOList}">
									<c:if test="${goods.gdsNo != 0}">
										<c:set var="goodsFile" value="${goods.fileGroupVO.fileDetailVOList[0]}" />
										<div class="swiper-slide">
											<c:choose>
												<c:when test="${goods.commCodeGrpNo=='GD02'}">
													<!-- 티켓 상품일 경우 -->
													<form action="/shop/ticket/ticketDetail" method="get">
														<input type="hidden" name="gdsNo" value="${goods.gdsNo}">
														<button class="card-goods">
															<img src="/upload${goods.ticketVO.tkFileSaveLocate}" class="bg-img" />
														</button>
														<div class="goods-name">
															<h6>${goods.gdsNm}</h6>
														</div>
														<h5>
															₩
															<fmt:formatNumber value="${goods.unitPrice}" type="number" />
														</h5>
													</form>
												</c:when>
												<c:otherwise>
													<form
														action="/shop/artistGroup/${goods.artGroupNo}/detail/${goods.gdsNo}">
														<button class="card-goods">
															<img src="/upload${goodsFile.fileSaveLocate}" class="bg-img" />
														</button>
														<div class="goods-name">
															<h6>${goods.gdsNm}</h6>
														</div>
														<h5>
															₩
															<fmt:formatNumber value="${goods.unitPrice}" type="number" />
														</h5>
													</form>
												</c:otherwise>
											</c:choose>
										</div>
									</c:if>
								</c:forEach>
							</c:forEach>
						</div>
						<div class="swiper-pagination" style="--swiper-theme-color:#F86D72 !important;"></div>
					</div>
					<!-- 굿즈 리스트 (캐러셀) 끝 -->
				</div>
			</c:if>
			<!-- 구독한 그룹의 굿즈샵 끝 -->
		</sec:authorize>
		<!-- ///// 회원 관점 끝 ///// -->

		<!-- ///// 비회원 관점 시작 ///// -->
		<!-- DM 리스트 시작-->
		<div class="container py-5">
			<h5 class="text fw-bold mb-4" style="color: black !important;">
				<spring:message code="home.dm.title" />
				<button class="svg-btn" onclick="getDMList()">
					<svg xmlns="http://www.w3.org/2000/svg" width="27" height="27"
						fill="#33C1CF" stroke-width="2.5" class="bi bi-arrow-clockwise"
						viewBox="0 0 16 16" style="margin-left: 10px;">
					  <path fill-rule="evenodd"
							d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2z" />
					  <path
							d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466" />
					</svg>
				</button>
			</h5>
			<!-- DM 리스트 반복 시작 -->
			<div id="dmListContainer">
				<c:forEach var="artGroup" items="${dmList}" varStatus="status" begin="0" end="9">
					<input type="hidden" value="${artGroup.artGroupNo}" />
					<!-- 그룹 번호 (PK) -->
					<button class="btn-dmlist">
						<!-- 그룹 로고 -->
						<div class="logo-wrap">
							<img src="/upload${artGroup.fileLogoSaveLocate}">
						</div>
						<!-- 그룹 명 -->
						<div class="card-body">
							<h6>${artGroup.artGroupNm}</h6>
						</div>
					</button>
				</c:forEach>
			</div>
			<!-- DM 리스트 반복 끝 -->
			<br> <br> <br><br> 
			<img src="https://tpc.googlesyndication.com/simgad/17702928538065432889"
				width="60%" style="display: block; margin: 0 auto;" />
		</div>
		<!-- DM 리스트 끝-->

		<!-- 아티스트 그룹 리스트 시작 -->
		<div class="container py-5">
			<h5 class="text fw-bold mb-4">
				<spring:message code="home.new.art.title" />
			</h5>
			<div class="d-flex flex-wrap justify-content-start"
				style="gap: 35px;">
				<!-- 모든 그룹 출력 시작 -->
				<c:forEach var="artGroup" items="${newArtistGroupList}">
					<c:set var="groupFile" value="${artGroup.fileGroupVO.fileDetailVOList[0]}" />
					<c:set var="groupFile" value="${artGroup.fileGroupVO.fileDetailVOList[0]}" />
					<form action="/oho/groupProfile" method="get">
						<input type="hidden" name="artGroupNo" value="${artGroup.artGroupNo}" />
						<!-- 그룹 번호 (PK) -->
						<button class="card-artist">
							<!-- 그룹 대표 이미지 -->
							<img src="/upload${groupFile.fileSaveLocate}" class="bg-img">
							<!-- 그룹 로고 -->
							<div class="logo-wrap">
								<img src="/upload${artGroup.fileLogoSaveLocate}">
							</div>
							<!-- 그룹 명 -->
							<div class="card-body">
								<h6>${artGroup.artGroupNm}</h6>
							</div>
						</button>
					</form>
				</c:forEach>
				<!-- 모든 그룹 출력 끝 -->
			</div>
		</div>
		<!-- 아티스트 그룹 리스트 끝 -->
		<!-- ///// 비회원 관점 끝 ///// -->
	</main>

	<script>
	
	let swiper;

	document.addEventListener("DOMContentLoaded", () => {
		swiper = new Swiper(".mySwiper", {
			slidesPerView : 4.2,
			grabCursor : true,
			freeMode : true,
			pagination : {
				el : ".swiper-pagination",
				clickable : true,
			},
			navigation : false,
		});
	});
		
	</script>

	<%@ include file="footer.jsp"%>

	<!-- Scroll Top -->
	<a href="#" id="scroll-top"
		class="scroll-top d-flex align-items-center justify-content-center active">
		<i class="bi bi-arrow-up-short"></i>
	</a>

	<script src="/main/assets/js/main.js"></script>

	<script
		src="https://cdn.jsdelivr.net/npm/@egjs/flicking@4.10.1/dist/flicking.min.js"></script>
</body>
</html>