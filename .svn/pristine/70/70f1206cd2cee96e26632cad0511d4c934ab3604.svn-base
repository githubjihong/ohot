
<%@ page language="java" contentType="text/html; charset=UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%>

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>구독관리</title>
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
<link rel="stylesheet" href="/adminlte/dist/css/adminlte.min.css" />
<script src="/adminlte/dist/js/adminlte.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<link rel="stylesheet" type="text/css"
	href="https://ssl.pstatic.net/static.datalab/202405030736/css/datalab.css">

	
<style>
.left {
	width: 15%;
	position: fixed;
	right: 70%; /* 사이드바의 넓이를 고려해서 20px 여유를 줌 */
	top: 16%; /* 헤더가 있는 곳에서 위쪽 여백을 50px로 설정 */
	z-index: 999; /* 다른 요소들보다 위에 표시되도록 설정 */
}

.right {
	width: 60%;
	position: fixed;
	right: 11%; /* 사이드바의 넓이를 고려해서 20px 여유를 줌 */
	top: 26%; /* 헤더가 있는 곳에서 위쪽 여백을 50px로 설정 */
	z-index: 999; /* 다른 요소들보다 위에 표시되도록 설정 */
}

.footer {
	width: 100%;
	position: fixed;
	top: 93%; /* 헤더가 있는 곳에서 위쪽 여백을 50px로 설정 */
}

.graph_period {
  display: flex;
  gap: 10px;
}

.period {
  display: inline-block;
  padding: 10px 20px;
  background-color: #f1f1f1;
  border: 1px solid #ccc;
  border-radius: 5px;
  cursor: pointer;
  text-align: center;
  font-size: 16px;
  transition: background-color 0.3s ease, border-color 0.3s ease;
}

input[type="radio"]:checked + label {
  background-color: skyblue;
  color: white;
  border-color: skyblue;
}


</style>
</head>
<body>

	<!-- 관리자 헤더네비바  -->
	<%@ include file="../adminHeader.jsp"%>

	<!-- 관리자 사이드바 -->
	<%@ include file="../adminSidebar.jsp"%>
	<div class="content-wrapper">

		<div class="section_serch_area statistics_top_area" style="width: 80%;">
				<div class="date_indo">
		  <div class="date_indo_inner">
		    <a href="#" onclick="btnPrev()" id="js-pagination" class="date_btn prev"><span class="blind">이전 날짜로 가기</span></a> 
		    <a href="#" onclick="btnNext()" class="date_btn next" id="nextDateBtn"><span class="blind">다음 날짜로 가기</span></a>
		    <div class="date_box _date_trigger _open">
		      <span class="date_txt" id="currentDate">${subscription[0].joinYmd}</span> 
		      <a href="#none" class="date_ico"><span class="blind">달력</span></a>
		    </div>
		  </div>
		</div>
		
		<div class="info_box">
			<div class="horizontal_list">
				<ul class="list_group">
					<li><span class="num">351,916</span> <span class="list_txt">총 회원수</span></li>
					<li><span class="num">30,159</span> <span class="list_txt">총 멤버십가입수</span></li>
					<li><span class="num">426</span> <span class="list_txt">탈퇴한 회원수</span></li>
				</ul>
			</div>
		</div>
	</div>


	<br>
	<div class="left">
	
	
	
	
		
		

		<div class="right">
			
			
			<div class="graph_period" style="right: 51px;">
			  <input type="radio" name="item_period" id="set_period_0" class="blind">
			  <label for="set_period_0" class="period box">전체</label>
			  
			  <input type="radio" name="item_period" id="set_period_1" class="blind">
			  <label for="set_period_1" class="period box">10대</label>
			  
			  <input type="radio" name="item_period" id="set_period_2" class="blind">
			  <label for="set_period_2" class="period box">20대</label>
			  
			  <input type="radio" name="item_period" id="set_period_3" class="blind">
			  <label for="set_period_3" class="period box">30대</label>
			  
			  <input type="radio" name="item_period" id="set_period_4" class="blind">
			  <label for="set_period_4" class="period box">40대</label>
			  
			  <input type="radio" name="item_period" id="set_period_5" class="blind">
			  <label for="set_period_5" class="period box">50대</label>
			  
			  <input type="radio" name="item_period" id="set_period_6" class="blind">
			  <label for="set_period_6" class="period box">60대</label>
			</div>
			
			
			<canvas id="myChart"></canvas>
		</div>

	</div>
</div>



	<!-- 관리자 풋터 -->
	<div class="footer">
		<%@ include file="../adminFooter.jsp"%>
	</div>
</body>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
	/* 차트 스크립트 */
	const ctx = document.getElementById('myChart');
	 
	//1) 202503 : 2025년 03월
	//이전달
	function btnPrev(joinYmd){
		
		//202503 -> 202502로 변경
		joinYmd = "${statsVO.joinYmd}";//202503
		console.log("joinYmd : ", joinYmd);
		
		//202503 -> 202502
		if (joinYmd == null || joinYmd == "") { return "-" }
	    else {
	    	 // 'joinYmd'가 "202503" 같은 형태라면, 연도(YYYY), 월(MM), 일(DD)을 분리
	        let joinYmd = "${param.joinYmd}"; 
		    console.log("joinYmd : ", joinYmd);
		    let y = parseInt(joinYmd.substring(0, 4));  // 연도
		    let m = parseInt(joinYmd.substring(4, 6));  // 월
	
	        // 월을 한 달 뺀다
	        m = m - 1;

	        // 만약 월이 0보다 작다면, 이전 해의 12월로 변경
	        if (m < 1) {
	            m = 12;
	            y = y - 1;  // 연도를 한 해 이전으로 변경
	        }
	        // 월(MM)이 한 자릿수일 경우 2자리로 변경 (예: 3 -> 03)
	         m = m < 10 ? "0" + m : m;  // 10월 미만 2자리로 변경
    		const prevDate = y + m;

	        // "YYYY-MM-DD" 형식으로 반환
    		console.log("Previous Date: ", prevDate);
    	    location.href = "/admin/stats/subscription?joinYmd=" + prevDate;
	    }
		
		//결과 ; /admin/stats/subscription?joinYmd=202502
		// location.href="/admin/stats/subscription?joinYmd="+joinYmd;
	}
	 
	//1) 202503 : 2025년 03월
	//다름달
	function btnNext(){
		//202503 -> 202504로 변경
		let joinYmd = "${param.joinYmd}";//202503
		console.log("joinYmd : ", joinYmd);
		
		//202503 -> 202504
		
		//결과 ; /admin/stats/subscription?joinYmd=202504
		// location.href="/admin/stats/subscription?joinYmd="+joinYmd;
	}
	
	
	
	$(document).ready(function() {
		// /admin/stats/subscription?joinYmd=202503
		 let joinYmd = "${param.joinYmd}"; 
		console.log("joinYmd : ", joinYmd);
		
		$.ajax({
			url: "/admin/stats/listMemberAjax",
			type: "post",
			dataType: "json",
			success: function(resp) {
				console.log("====================================================1");
				console.log("resp : ", resp);
				getMember(resp);
			}
		});
	}); 
	
	
	function getMember(listMemberAjax) {
			
	let labels = [];
	let data = [];
	
	console.log("getmember resp: ", listMemberAjax);
	
	$.each(listMemberAjax, function(idx, stats) {
		labels.push(stats.joinYmd);
		console.log("stats.joinYmd", stats.joinYmd );
		console.log("labels", labels);
		
		data.push(stats.memberCnt);
		console.log("stats.MemberCnt", stats.memberCnt);
		console.log("data", data);
	});	
	
	
	new Chart(ctx, {
		type : 'bar',
		data : {
			labels : labels,
			datasets : [ {
				label : ' of Votes',
				data : data,
				borderWidth : 3
			} ]
		},
		options : {
			scales : {
				y : {
					beginAtZero : true
				}
			}
		}
	});
	
	}
	
	// 현재 날짜 표시 요소
	const currentDateElement = document.getElementById('currentDate');

	// 날짜를 "YYYY.MM.DD" 형식으로 변환하는 함수
	function formatDate(currentPage, keyword) {
		/* var next = last + 1;
		var prev = first - 1; */
		if(currentPage==""||currentPage==null||currentPage== undefined){
		      currentPage = "1";
		}
		   
		console.log("js-pagination a");	

		$("#js-pagination a").click(function (e) {
			str += `
				<div class="col-md-3">
				<div class="card">
				<div class="card-header">
					<h3 class="card-title">
					<i class="fas fa-text-width"></i>
					<b>[\${bookInfoVO.category}] 
						<a href="/stats/subscription?memNo=\${StatsVO.memNo}">\${StatsVO.memNo}</a>
					</b>
					</h3>
				</div>  
				<div class="card-body">
					<!-- CLOB -->
					\${StatsVO.memNo}
				</div>
				</div>
			</div>
			`;
		});
	}
	

</script>


</html>