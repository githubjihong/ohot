<%@ page language="java" contentType="text/html; charset=UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%>

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>구독관리</title>

<!-- JS & CSS -->
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="/adminlte/dist/css/adminlte.min.css" />
<script src="/adminlte/dist/js/adminlte.min.js"></script>

<!-- 스타일 -->
<style>
/* .left, .right, .right2, .footer {
      position: fixed;
      z-index: 999;
    } */
.left {
	float: left;
	width: 83%;
	height: 160px;
}


.right {
	float: right;
	width: 15%;
	height: 160px;
}
.right3 {
	float: right;
	width: 100%;
	height: 160px;
	margin-right: 3%;
	margin-top: -0%; /* 또는 3% 정도로 줄여보세요 */
}

.right2 {
	vertical-align: top;
	display: inline-block;
	width: 100%;
	height: 300px;
	margin-left: 0%;
	margin-top: 30%; /* 또는 3% 정도로 줄여보세요 */
}


.footer {
	width: 100%;
	top: auto;
}

.sidebarTemp {
	height: 110%;
}

.content {
	padding: 100px 20px 0 40px;
	position: relative;
	width: 100%;
}

.period {
	display: inline-block;
	padding: 10px 20px;
	background-color: #f1f1f1;
	border: 1px solid #ccc;
	border-radius: 5px;
	cursor: pointer;
	font-size: 16px;
}

input[type="radio"]:checked+label {
	background-color: skyblue;
	color: white;
	border-color: skyblue;
}

select.form-control {
	border: 1px solid #ced4da;
	border-radius: 4px;
	background-color: #fff;
	padding: 5px;
}

.ellipsis {
	max-width: 200px; /* 원하는 최대 너비 설정 */
	white-space: nowrap; /* 줄바꿈 방지 */
	overflow: hidden; /* 넘친 내용 감추기 */
	text-overflow: ellipsis; /* 말줄임표 (...) 처리 */
}
.ellipsis2 {
	max-width: 100px; /* 원하는 최대 너비 설정 */
	white-space: nowrap; /* 줄바꿈 방지 */
	overflow: hidden; /* 넘친 내용 감추기 */
	text-overflow: ellipsis; /* 말줄임표 (...) 처리 */
}
</style>
</head>

<body class="sidebar-mini">

	<%@ include file="../adminHeader.jsp"%>
	<div class="sidebarTemp">
		<%@ include file="../adminSidebar.jsp"%>
	</div>
	<div class="content-wrapper" style="padding: 20px;">
		<div class="card card-secondary">
			<div class="card-header"></div>

			<!-- 검색 폼 -->
			<form id="frm" name="frm" action="/admin/stats/goodsStatistics" method="get">
				<div class="card-body">
					<div class="row">
						<div class="col-md-2">
							<label class="small">상품번호</label>
							<input type="text" class="form-control" id="gdsNo" name="gdsNo" placeholder="상품번호">
			
							<label class="small">조회기간 시작</label>
							<input type="text" class="form-control" id="startDate" name="startDate" placeholder="YYYY-MM-DD">
						</div>
						<div class="col-md-2">
							<label class="small">상품유형</label>
							<select id="gdsDelYn" name="gdsDelYn" class="form-control">
								<option value="all">전체보기</option>
								<option value="G">G:그룹상품</option>
								<option value="I">I:개별상품</option>
								<option value="M">  M: MEMBERSHIP</option>
								<option value="A">A: ALBUM</option>
								<option value="D">D: DM</option>
							</select>
  							
							<label class="small">조회기간 종료</label>
							<input type="text" class="form-control" id="endDate" name="endDate" placeholder="YYYY-MM-DD">
						</div>
						<div class="col-md-2">
							<label class="small">상품명</label>
							<input type="search" name="keyword" class="form-control" placeholder="검색어를 입력해주세요" value="${param.keyword}" />
						</div>
						<div class="col-md-2">
							<label class="small">상품단가</label>
							<input type="text" class="form-control" id="unitPrice" name="unitPrice" placeholder="상품단가">
						</div>
						<div class="col-md-2">
							<label class="small">구매건수</label>
							<input type="text" class="form-control" id="productPurchases" name="productPurchases" placeholder="구매건수">
						</div>
						<div class="col-md-1">
							<label class="small">상품수</label>
							<input type="text" class="form-control" id="goodsNum" name="goodsNum" placeholder="상품수">
							
							<br>
						
							<button type="reset" class="btn btn-outline-dark mt-2 w-100">초기화</button>
						</div>
						<div class="col-md-1 d-flex align-items-end">
							<button type="submit" class="btn btn-outline-primary w-100">검색</button>
						</div>
					</div>
				</div>
			</form>
		</div>
		<!-- 리스트 영역 (겹침 방지를 위한 margin-top 추가됨) -->
		<div class="left">
			<div class="d-flex justify-content-end mb-2 w-100">
				<a href="/admin/shop/adGoodsCreate" class="btn btn-primary "> <i
					class="fas fa-plus"></i> exel
				</a>
			</div>
			<div class="card-body table-responsive p-0">
				<table class="table table-hover text-nowrap">
					<thead>
						<tr>
							<th>목록번호</th>
							<th>상품번호</th>
							<th>상품유형</th>
							<th>상품명</th>
							<th>상품단가</th>
							<th>구매건수</th>
							<th>등록일자</th>
							<th>아티스트 그룹번호</th>
							<th>그룹명</th>
							<th>상품수</th>
							<th>판매율</th>
						</tr>
					</thead>
					<tbody>
						<c:forEach var="statsVO" items="${goodsStatistics}"
							varStatus="stat">
							<tr>
								<td>${statsVO.rnum}</td>
								<td>${statsVO.gdsNo}</td>
								<td>${statsVO.gdsType}</td>
								<td class="ellipsis">${statsVO.gdsNm}</td>
								<td>${statsVO.unitPrice}</td>
								<td>${statsVO.productPurchases}</td>
								<td>${statsVO.regDt}</td>
								<td>${statsVO.artGroupNo}</td>
								<td>${statsVO.artGroupNm}</td>
								<td>${statsVO.goodsNum}</td>
								<td>${statsVO.competition}</td>
							</tr>
						</c:forEach>
					</tbody>
				</table>
			</div>
			<div class="row">
				<div class="col-sm-12 col-md-5">
					<div class="dataTables_info" id="example2_info" role="status"
						aria-live="polite">
						Showing
						<!-- 
							ArticlePage(total=79, currentPage=1, totalPages=8, blockSize=5, startPage=1, endPage=5
								, keyword=, url=, content=[Item2VO(itemId=79, itemName=텀블러, price=36000, description=보라색, pictureUrl=null, pictureUrl2=null, fileGroupNo=20250226074, uploadFile=null, fileGroupVO=null), Item2VO(itemId=78, itemName=개똥아똥쌌니아니오, price=12000, description=똥싸지마, pictureUrl=null, pictureUrl2=null, fileGroupNo=20250226073, uploadFile=null, fileGroupVO=null), Item2VO(itemId=77, itemName=노란 스펀지, price=12345, description=네네모네모 스폰지밥~~~~, pictureUrl=null, pictureUrl2=null, fileGroupNo=20250226072, uploadFile=null, fileGroupVO=null), Item2VO(itemId=76, itemName=쇼파, price=800000, description=왕멋진쇼파, pictureUrl=null, pictureUrl2=null, fileGroupNo=20250226071, uploadFile=null, fileGroupVO=null), Item2VO(itemId=75, itemName=개똥이 홍보, price=11000, description=좋아요5, pictureUrl=null, pictureUrl2=null, fileGroupNo=20250226070, uploadFile=null, fileGroupVO=null), Item2VO(itemId=74, itemName=5개마지막이닷, price=4300, description=수여일, pictureUrl=null, pictureUrl2=null, fileGroupNo=20250226069, uploadFile=null, fileGroupVO=null), Item2VO(itemId=73, itemName=한개 더, price=10000, description=좋아요, pictureUrl=null, pictureUrl2=null, fileGroupNo=20250226068, uploadFile=null, fileGroupVO=null), Item2VO(itemId=72, itemName=애플, price=1000000, description=사과22, pictureUrl=null, pictureUrl2=null, fileGroupNo=20250226067, uploadFile=null, fileGroupVO=null), Item2VO(itemId=71, itemName=핸드크림, price=12000, description=구웃, pictureUrl=null, pictureUrl2=null, fileGroupNo=20250226066, uploadFile=null, fileGroupVO=null), Item2VO(itemId=70, itemName=해산물볶음밥, price=90000, description=비쌈, pictureUrl=null, pictureUrl2=null, fileGroupNo=20250226065, uploadFile=null, fileGroupVO=null)]
								, pagingArea=)
							 -->
						${(param.currentPage * 10)-(10-1)} to
						<!-- 종료행번호가 전체글수를 초과하면 전체글수로 보정해줘야 함 -->
						<c:set var="endRowNum" value="${param.currentPage * 10}" />
						<c:if test="${endRowNum > articlePage.total}">
							<c:set var="endRowNum" value="${articlePage.total}" />
						</c:if>
						${endRowNum} of ${articlePage.total} entries
					</div>
				</div>
				<div class="col-sm-12 col-md-7">
					<div class="dataTables_paginate paging_simple_numbers"
						id="example2_paginate">
						<ul class="pagination">
							<!-- 
								ArticlePage(total=79, currentPage=1, totalPages=8, blockSize=5, startPage=1, endPage=5
								, keyword=, url=, content=[Item2VO(itemId=79, itemName=텀블러, price=36000, description=보라색, pictureUrl=null, pictureUrl2=null, fileGroupNo=20250226074, uploadFile=null, fileGroupVO=null), Item2VO(itemId=78, itemName=개똥아똥쌌니아니오, price=12000, description=똥싸지마, pictureUrl=null, pictureUrl2=null, fileGroupNo=20250226073, uploadFile=null, fileGroupVO=null), Item2VO(itemId=77, itemName=노란 스펀지, price=12345, description=네네모네모 스폰지밥~~~~, pictureUrl=null, pictureUrl2=null, fileGroupNo=20250226072, uploadFile=null, fileGroupVO=null), Item2VO(itemId=76, itemName=쇼파, price=800000, description=왕멋진쇼파, pictureUrl=null, pictureUrl2=null, fileGroupNo=20250226071, uploadFile=null, fileGroupVO=null), Item2VO(itemId=75, itemName=개똥이 홍보, price=11000, description=좋아요5, pictureUrl=null, pictureUrl2=null, fileGroupNo=20250226070, uploadFile=null, fileGroupVO=null), Item2VO(itemId=74, itemName=5개마지막이닷, price=4300, description=수여일, pictureUrl=null, pictureUrl2=null, fileGroupNo=20250226069, uploadFile=null, fileGroupVO=null), Item2VO(itemId=73, itemName=한개 더, price=10000, description=좋아요, pictureUrl=null, pictureUrl2=null, fileGroupNo=20250226068, uploadFile=null, fileGroupVO=null), Item2VO(itemId=72, itemName=애플, price=1000000, description=사과22, pictureUrl=null, pictureUrl2=null, fileGroupNo=20250226067, uploadFile=null, fileGroupVO=null), Item2VO(itemId=71, itemName=핸드크림, price=12000, description=구웃, pictureUrl=null, pictureUrl2=null, fileGroupNo=20250226066, uploadFile=null, fileGroupVO=null), Item2VO(itemId=70, itemName=해산물볶음밥, price=90000, description=비쌈, pictureUrl=null, pictureUrl2=null, fileGroupNo=20250226065, uploadFile=null, fileGroupVO=null)]
								, pagingArea=)
								블록시작번호가 6(블록크기 + 1)보다 작을 때 비활성 처리-->
			                <li class="paginate_button page-item 
								<c:if test="${articlePage.startPage le 1}">disabled</c:if>">
								<a class="page-link"
								   href="/admin/stats/goodsStatistics?currentPage=1&keyword=${param.keyword}"><<</a>
							</li>
							<li
								class="paginate_button page-item previous 
									<c:if test="${articlePage.startPage lt (articlePage.blockSize + 1)}"></c:if>
								">
								<a
								href="/admin/stats/goodsStatistics?currentPage=${articlePage.startPage-articlePage.blockSize}&keyword=${param.keyword}"
								class="page-link"><</a>
							</li>
							<!-- 
								ArticlePage(total=79, currentPage=1, totalPages=8
								, blockSize=5, startPage=1, endPage=5
								, keyword=, url=, content=..
								, pagingArea=)
								
								, 골뱅이RequestParam(value="currentPage",required=false,defaultValue="1") int currentPage
								, 골뱅이RequestParam(value="keyword",required=false,defaultValue="") String keyword
								 -->
							<c:forEach var="pNo" begin="${articlePage.startPage}"
								end="${articlePage.endPage}" step="1">
								<!-- active :  
									/item/list2?currentPage=2&keyword=
									pNo가 2일때
									
									param : currentPage=2&keyword=
									param.currentPage : 2
									-->
								<li
									class="paginate_button page-item 
										<c:if test="${param.currentPage eq pNo}">active</c:if>
									">
									<a
									href="/admin/stats/goodsStatistics?currentPage=${pNo}&keyword=${param.keyword}"
									class="page-link">${pNo}</a>
								</li>
							</c:forEach>
							<!-- 
								블록종료번호가 전체페이지수를 초과하면 안됨
								
								ArticlePage(total=79, currentPage=1, totalPages=8
								, blockSize=5, startPage=1, endPage=5
								, keyword=, url=, content=..
								, pagingArea=)
								 -->
							<!-- EL태그 정리 
									== : eq(equal)
									!= : ne(not equal)
									<  : lt(less than)
									>  : gt(greater than)
									<= : le(less equal)
									>= : ge(greater equal)
								 -->
							<li
								class="paginate_button page-item next
									<c:if test="${articlePage.endPage ge articlePage.totalPages}"></c:if>
								">
								<a
								href="/admin/stats/goodsStatistics?currentPage=${articlePage.startPage+articlePage.blockSize}&keyword=${param.keyword}"
								class="page-link">></a>
								
							</li>
							<li class="paginate_button page-item 
								<c:if test="${articlePage.endPage ge articlePage.totalPages}">disabled</c:if>">
								<a class="page-link"
								   href="/admin/stats/goodsStatistics?currentPage=${articlePage.totalPages}&keyword=${param.keyword}">&gt;&gt;</a>
							</li>
						</ul>
					</div>
				</div>
			</div>
		</div>

		<!-- 인기 차트 -->
		<div class="right">
			<div class="section_insite_sub">
				<div class="section_insite">
					<br>
					<h4 class="insite_title">
						<strong>이번달</strong> 굿즈 인기판매순
					</h4>
					<strong>TOP 10</strong>
				</div>
					<div class="rank_top10">
					<div class="right3">
						
						<div class="row">
							<div class="col-12 table-responsive">
								<table class="table table-striped">
									<thead>
										<tr>
											<th>NO</th>
											<th>굿즈상품명</th>
											<th>아티스트</th>
										</tr>
									</thead>
									<tbody>
									<c:forEach var="statsVO" items="${topList}"
										varStatus="stat">
										<tr>
											<td>${statsVO.rnum}</td>
											<td class="ellipsis2">${statsVO.gdsNm}</td>
											<td class="ellipsis2">${statsVO.artGroupNm}</td>
										</tr>
									</c:forEach>

									</tbody>
								</table>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>


		
		
	</div>

	<%@ include file="../adminFooter.jsp"%>
	<!--   <script src="/js/stats/goodStatiList.js"></script> -->

	<script>
    const ctx = document.getElementById('myChart');

    $(function () {
      $.ajax({
        url: "/admin/stats/GoodsStatisticsAjax",
        method: "post",
        dataType: "json",
        success: function (resp) {
          console.log("이번달 티켓 굿즈 디엠 멤버십 현황->resp : ", resp);
        	
        	
          drawChart(resp);
        }
      });
    });

    function drawChart(dataList) {
      const labels = dataList.map(item => item.regDt);
      const data = dataList.map(item => item.CNT9);

      new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: '가입자 수',
            data: data,
            borderWidth: 1,
            backgroundColor: 'rgba(54, 162, 235, 0.5)'
          }]
        },
        options: {
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    }
  </script>

</body>
</html>
