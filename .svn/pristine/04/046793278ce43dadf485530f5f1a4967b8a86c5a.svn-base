package com.ohot.shop.controller;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;

import com.ohot.shop.service.TicketService;
import com.ohot.shop.vo.GoodsVO;
import com.ohot.shop.vo.SeatVO;
import com.ohot.shop.vo.TicketVO;
import com.ohot.shop.vo.TkDetailVO;

import lombok.extern.slf4j.Slf4j;

@Slf4j
@Controller
@RequestMapping("/shop/ticket")
public class TicketController {
	
	@Autowired
	TicketService ticketService;
	
	//티켓 리스트 출력
	@GetMapping("/ticketList")
	public String ticketList(Model model,@RequestParam(value = "tkCtgr", required = false) String tkCtgr) {
		List<GoodsVO> goodsVOList = this.ticketService.ticketList(tkCtgr);
		log.info("ticketList -> GoodsVO : "+goodsVOList);
		
		model.addAttribute("goodsVOList", goodsVOList);
		
		
		return "ticket/ticketList";
	}
	
	//티켓 디테일
	@GetMapping("/ticketDetail")
	public String ticketDetail(Model model
			, @RequestParam(value="gdsNo") int gdsNo
			, GoodsVO goodsVO) {
		log.info("ticketDetail -> gdsNo: " +gdsNo);
		log.info("ticketDetail -> ticketVO: " +goodsVO);

		goodsVO = this.ticketService.ticketDetail(goodsVO);
		log.info("ticketDetail -> goodsVO(후): "+goodsVO);
		
		model.addAttribute("goodsVO", goodsVO);
		
		return "ticket/ticketDetail";
	}
	
	//티켓 좌석선택
	@GetMapping("/seat")
	public String seat(long tkNo, long tkDetailNo ,  Model model) {
		log.info("seat->tkNo: "+tkNo);
		log.info("seat->tkDetailNo: "+tkDetailNo);
		
		//좌석정보
		List<SeatVO> seatVO = this.ticketService.tkSeat(tkDetailNo);
		model.addAttribute("seatVO", seatVO);
		log.info("seat->seatVO : "+seatVO);
		
		//다른회차정보
		List<TkDetailVO> tkDetailVOList =this.ticketService.seatTkDetail(tkNo);
		model.addAttribute("tkDetailVOList", tkDetailVOList);
		log.info("seat-> tkDetailVOList: "+tkDetailVOList);
		
		
		return "ticket/seat";
	}
	
}
