<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html lang='ko'>
  <head>
    <meta charset='utf-8' />
    <title>í’€ìº˜ë¦°ë” í…ŒìŠ¤íŠ¸</title>
    
    <!-- FullCalendar CDN -->
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.17/index.global.min.js'></script>
    
    <!-- jQuery & Axios -->
    <script src="/js/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <!-- FullCalendar CSS -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.17/main.min.css" rel="stylesheet" />

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <style>
      body {
        padding: 20px;
        background-color: #f8f9fa;
      }
      #external-events .fc-event {
        cursor: grab;
        margin-bottom: 10px;
        padding: 8px 12px;
        background-color: #0d6efd;
        color: white;
        border-radius: 5px;
      }
      #calendar {
        min-height: 600px;
      }
    </style>


  </head>
  <body>
    <div class="container">
      <h1 class="mb-4 text-center fw-bold">ğŸ“… ì•„í‹°ìŠ¤íŠ¸ ì¼ì • ê´€ë¦¬</h1>
      <div class="row">
        <!-- ì™¸ë¶€ ì´ë²¤íŠ¸ ëª©ë¡ -->
        <div class="col-md-3 mb-4">
          <div class="card shadow-sm">
            <div class="card-header bg-primary text-white fw-bold">
              ì™¸ë¶€ ì¼ì • ëª©ë¡
            </div>
            <div class="card-body" id="external-events">
              <div class="fc-event" data-title="ì¹´ë¦¬ë‚˜">ì¹´ë¦¬ë‚˜</div>
              <div class="fc-event" data-title="ìœˆí„°">ìœˆí„°</div>
              <div class="fc-event" data-title="ë‹ë‹">ë‹ë‹</div>
              <div class="fc-event" data-title="ì§€ì ¤">ì§€ì ¤</div>
            </div>
          </div>
        </div>

        <!-- FullCalendar -->
        <div class="col-md-9">
          <div class="card shadow-sm">
            <div class="card-header bg-success text-white fw-bold">
              ì¼ì • ìº˜ë¦°ë”
            </div>
            <div class="card-body">
              <div id="calendar"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
<!-- Bootstrap 5 ëª¨ë‹¬ -->
<div class="modal fade" id="eventDetailModal" tabindex="-1" aria-labelledby="eventDetailModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="eventDetailModalLabel">ì¼ì • ìƒì„¸ë³´ê¸°</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ë‹«ê¸°"></button>
      </div>
      <div class="modal-body">
        <form id="eventForm">
          <div class="mb-3">
            <label for="eventTitle" class="form-label">ì œëª©</label>
            <input type="text" class="form-control" id="eventTitle">
          </div>
          <div class="mb-3">
            <label for="eventStart" class="form-label">ì‹œì‘ì¼</label>
            <input type="date" class="form-control" id="eventStart">
          </div>
          <div class="mb-3">
            <label for="eventEnd" class="form-label">ì¢…ë£Œì¼</label>
            <input type="date" class="form-control" id="eventEnd">
          </div>
          <div class="mb-3">
            <label for="eventDesc" class="form-label">ë‚´ìš©</label>
            <textarea class="form-control" id="eventDesc" rows="3" placeholder="ì„¸ë¶€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
        <button type="button" class="btn btn-primary" id="saveEventBtn">ì €ì¥</button>
        <button type="button" class="btn btn-danger" id="deleteEventBtn">ì‚­ì œ</button>
      </div>
    </div>
  </div>
</div>
<script>
  let selectedEvent = null; // í´ë¦­í•œ ì´ë²¤íŠ¸ ì €ì¥ìš©


  function getSchedule(){
    
  }

  document.addEventListener('DOMContentLoaded', function () {
    new FullCalendar.Draggable(document.getElementById('external-events'), {
      itemSelector: '.fc-event',
      eventData: function (eventEl) {
        return { title: eventEl.dataset.title };
      }
    });

    var calendarEl = document.getElementById('calendar');
    var calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      editable: true,
      droppable: true,
      timeZone:'local',
      selectable:true,
      selectMirror:true,
	  unselectAuto:true,
      eventClick: function (info) {
        const event = info.event;
        selectedEvent = event;

        document.getElementById("eventTitle").value = event.title;
        document.getElementById("eventStart").value = event.start?.toISOString().slice(0, 10) || '';
        document.getElementById("eventEnd").value = event.end?.toISOString().slice(0, 10) || '';
        document.getElementById("eventDesc").value = event.extendedProps.description || '';

        const modal = new bootstrap.Modal(document.getElementById('eventDetailModal'));
        modal.show();
      },

      drop: function (info) {
        alert("ì¼ì •ì´ '" + info.draggedEl.dataset.title +  "'ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.");
        document.getElementById("eventEnd").value=document.getElementById("eventStart").value;
      }
    });

    calendar.render();

    // ì €ì¥ ë²„íŠ¼ í´ë¦­ ì‹œ
    document.getElementById("saveEventBtn").addEventListener("click", function () {
      if (selectedEvent) {
        selectedEvent.setProp("title", document.getElementById("eventTitle").value);
        selectedEvent.setStart(document.getElementById("eventStart").value);
        selectedEvent.setEnd(document.getElementById("eventEnd").value);
        selectedEvent.setExtendedProp("description", document.getElementById("eventDesc").value);

        bootstrap.Modal.getInstance(document.getElementById('eventDetailModal')).hide();
      }
    });

    // ì‚­ì œ ë²„íŠ¼ í´ë¦­ ì‹œ
    document.getElementById("deleteEventBtn").addEventListener("click", function () {
      if (selectedEvent && confirm("ì •ë§ ì´ ì¼ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
        selectedEvent.remove();
        bootstrap.Modal.getInstance(document.getElementById('eventDetailModal')).hide();
      }
    });
  });
</script>
  </body>
</html>
