<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html lang='ko'>
  <head>
    <meta charset='utf-8' />
    <title>풀캘린더 테스트</title>
    
    <!-- FullCalendar CDN -->
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.17/index.global.min.js'></script>
    
    <!-- jQuery & Axios -->
    <script src="/js/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <!-- FullCalendar CSS -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.17/main.min.css" rel="stylesheet" />

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <style>
      body {
        padding: 20px;
        background-color: #f8f9fa;
      }
      #external-events .fc-event {
        cursor: grab;
        margin-bottom: 10px;
        padding: 8px 12px;
        background-color: #0d6efd;
        color: white;
        border-radius: 5px;
      }
      #calendar {
        min-height: 600px;
      }
    </style>


  </head>
  <body>
    <div class="container">
      <h1 class="mb-4 text-center fw-bold">📅 아티스트 일정 관리</h1>
      <div class="row">
        <!-- 외부 이벤트 목록 -->
        <div class="col-md-3 mb-4">
          <div class="card shadow-sm">
            <div class="card-header bg-primary text-white fw-bold">
              외부 일정 목록
            </div>
            <div class="card-body" id="external-events">
              <div class="fc-event" data-title="카리나">카리나</div>
              <div class="fc-event" data-title="윈터">윈터</div>
              <div class="fc-event" data-title="닝닝">닝닝</div>
              <div class="fc-event" data-title="지젤">지젤</div>
            </div>
          </div>
        </div>

        <!-- FullCalendar -->
        <div class="col-md-9">
          <div class="card shadow-sm">
            <div class="card-header bg-success text-white fw-bold">
              일정 캘린더
            </div>
            <div class="card-body">
              <div id="calendar"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
<!-- Bootstrap 5 모달 -->
<div class="modal fade" id="eventDetailModal" tabindex="-1" aria-labelledby="eventDetailModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="eventDetailModalLabel">일정 상세보기</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="닫기"></button>
      </div>
      <div class="modal-body">
        <form id="eventForm">
          <div class="mb-3">
            <label for="eventTitle" class="form-label">제목</label>
            <input type="text" class="form-control" id="eventTitle">
          </div>
          <div class="mb-3">
            <label for="eventStart" class="form-label">시작일</label>
            <input type="date" class="form-control" id="eventStart">
          </div>
          <div class="mb-3">
            <label for="eventEnd" class="form-label">종료일</label>
            <input type="date" class="form-control" id="eventEnd">
          </div>
          <div class="mb-3">
            <label for="eventDesc" class="form-label">내용</label>
            <textarea class="form-control" id="eventDesc" rows="3" placeholder="세부 내용을 입력하세요"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
        <button type="button" class="btn btn-primary" id="saveEventBtn">저장</button>
        <button type="button" class="btn btn-danger" id="deleteEventBtn">삭제</button>
      </div>
    </div>
  </div>
</div>
<script>
  let selectedEvent = null; // 클릭한 이벤트 저장용


  function getSchedule(){
    
  }

  document.addEventListener('DOMContentLoaded', function () {
    new FullCalendar.Draggable(document.getElementById('external-events'), {
      itemSelector: '.fc-event',
      eventData: function (eventEl) {
        return { title: eventEl.dataset.title };
      }
    });

    var calendarEl = document.getElementById('calendar');
    var calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      editable: true,
      droppable: true,
      timeZone:'local',
      selectable:true,
      selectMirror:true,
	  unselectAuto:true,
      eventClick: function (info) {
        const event = info.event;
        selectedEvent = event;

        document.getElementById("eventTitle").value = event.title;
        document.getElementById("eventStart").value = event.start?.toISOString().slice(0, 10) || '';
        document.getElementById("eventEnd").value = event.end?.toISOString().slice(0, 10) || '';
        document.getElementById("eventDesc").value = event.extendedProps.description || '';

        const modal = new bootstrap.Modal(document.getElementById('eventDetailModal'));
        modal.show();
      },

      drop: function (info) {
        alert("일정이 '" + info.draggedEl.dataset.title +  "'로 추가되었습니다.");
        document.getElementById("eventEnd").value=document.getElementById("eventStart").value;
      }
    });

    calendar.render();

    // 저장 버튼 클릭 시
    document.getElementById("saveEventBtn").addEventListener("click", function () {
      if (selectedEvent) {
        selectedEvent.setProp("title", document.getElementById("eventTitle").value);
        selectedEvent.setStart(document.getElementById("eventStart").value);
        selectedEvent.setEnd(document.getElementById("eventEnd").value);
        selectedEvent.setExtendedProp("description", document.getElementById("eventDesc").value);

        bootstrap.Modal.getInstance(document.getElementById('eventDetailModal')).hide();
      }
    });

    // 삭제 버튼 클릭 시
    document.getElementById("deleteEventBtn").addEventListener("click", function () {
      if (selectedEvent && confirm("정말 이 일정을 삭제하시겠습니까?")) {
        selectedEvent.remove();
        bootstrap.Modal.getInstance(document.getElementById('eventDetailModal')).hide();
      }
    });
  });
</script>
  </body>
</html>
