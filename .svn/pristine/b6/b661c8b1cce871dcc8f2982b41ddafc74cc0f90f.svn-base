package com.ohot.admin.service.impl;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.web.multipart.MultipartFile;

import com.ohot.admin.mapper.AdminGoodsMapper;
import com.ohot.admin.service.AdminGoodsService;
import com.ohot.shop.vo.GoodsVO;
import com.ohot.shop.vo.TicketVO;
import com.ohot.shop.vo.TkDetailVO;
import com.ohot.util.UploadController;
import com.ohot.vo.FileDetailVO;
import com.ohot.vo.FileGroupVO;

import lombok.extern.slf4j.Slf4j;

@Slf4j
@Service
public class AdminGoodsServiceImpl implements AdminGoodsService {
	
	@Autowired
	AdminGoodsMapper adminGoodsMapper;
	
	@Autowired
	UploadController uploadController;
	

	@Override
	public int ticketInsert(GoodsVO goodsVO, MultipartFile[] uploadFiles) {

		long fileGroupNo=this.uploadController.multiImageUpload(uploadFiles);
		
		goodsVO.setFileGroupNo(fileGroupNo);
		this.adminGoodsMapper.goodsInsert(goodsVO);
		log.info("-------------"+goodsVO);
		
		TicketVO ticketVO = goodsVO.getTicketVO();
        ticketVO.setGdsNo(goodsVO.getGdsNo());  // 외래키 설정
        this.adminGoodsMapper.ticketInsert(ticketVO);  // Ticket INSERT
		
		return ticketVO.getGdsNo();
	}

	@Override
	public List<GoodsVO> ticketList() {
		// TODO Auto-generated method stub
		return this.adminGoodsMapper.ticketList();
	}


	@Override
	public FileDetailVO ticketPoster(MultipartFile[] uploadFile) {
		MultipartFile[] multipartFiles = uploadFile;

		long fileGroupNo = this.uploadController.multiImageUpload(multipartFiles);

		return this.adminGoodsMapper.ticketPosterImg(fileGroupNo);

	}

	@Override
	public int tkDetailInsert(TkDetailVO tkDetailVO) {
		return this.adminGoodsMapper.tkDetailInsert(tkDetailVO);
	}

	@Override
	public GoodsVO ticketDetail(int gdsNo) {
		// TODO Auto-generated method stub
		return this.adminGoodsMapper.ticketDetail(gdsNo);
	}



}
