<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ohot.admin.mapper.AdminCommunityMapper">

<select id="getTotalPost" resultType="int" parameterType="hashMap">
    SELECT COUNT(BOARD_NO)
    FROM COMMUNITY_POST
    WHERE 1=1
    <if test="boardTitle != null and boardTitle != ''">
       AND BOARD_TITLE LIKE '%' || #{boardTitle} || '%'
    </if>
    <if test="boardContent != null and boardContent != ''">
       AND BOARD_CONTENT LIKE '%' || #{boardContent} || '%'
    </if>
    <if test="boardOnlyMembership != null and boardOnlyMembership != ''">
       AND BOARD_ONLY_MEMBERSHIP = #{boardOnlyMembership}
    </if>
    <if test="boardDelyn != null and boardDelyn != ''">
       AND BOARD_DELYN = #{boardDelyn}
    </if>
	<if test="boardCreateDate != null and boardCreateDate != ''">
		  AND TRUNC(BOARD_CREATE_DT) = #{boardCreateDate}
	</if>
    <if test="boardOnlyFan != null and boardOnlyFan != ''">
       AND BOARD_ONLY_FAN = #{boardOnlyFan}
    </if>
    <if test="urlCategory != null and urlCategory != ''">
       AND URL_CATEGORY = #{urlCategory}
    </if>
    <if test="memNo != null and memNo != ''">
    	AND MEM_NO = #{memNo}
    </if>
</select>

<select id="adminPostList" resultType="com.ohot.vo.AdminCommunityPostVO" parameterType="hashMap" >
	
SELECT * FROM
(
    SELECT
        ROWNUM AS RNUM
        ,COUNT(1) OVER() AS total_cnt
        ,A.*
    FROM(
        SELECT g.BOARD_NO, g.BOARD_TITLE, g.BOARD_CONTENT, g.BOARD_ONLY_MEMBERSHIP, g.FILE_GROUP_NO, g.BOARD_DELYN,
        
        TO_CHAR(g.BOARD_CREATE_DT,'YYYY-MM-DD') AS BOARD_CREATE_DATE,
        TO_CHAR(g.board_create_dt,'YYYY-MM-DD HH24:MI:SS') AS BOARD_CREATE_DT2
        
        , g.BOARD_ONLY_FAN, g.URL_CATEGORY, g.COM_PROFILE_NO, g.MEM_NO
        FROM COMMUNITY_POST g
        WHERE 1=1
	    <if test="boardTitle != null and boardTitle != ''">
	       AND g.BOARD_TITLE LIKE '%' || #{boardTitle} || '%'
	    </if>
	    <if test="boardContent != null and boardContent != ''">
	       AND g.BOARD_CONTENT LIKE '%' || #{boardContent} || '%'
	    </if>
	    <if test="boardOnlyMembership != null and boardOnlyMembership != ''">
	       AND g.BOARD_ONLY_MEMBERSHIP = #{boardOnlyMembership}
	    </if>
	    <if test="boardDelyn != null and boardDelyn != ''">
	       AND g.BOARD_DELYN = #{boardDelyn}
	    </if>
	    <if test="boardCreateDate != null and boardCreateDate != ''">
		   AND TRUNC(g.BOARD_CREATE_DT) = #{boardCreateDate}
	    </if>
	    <if test="boardOnlyFan != null and boardOnlyFan != ''">
	       AND g.BOARD_ONLY_FAN = #{boardOnlyFan}
	    </if>
	    <if test="urlCategory != null and urlCategory != ''">
	       AND g.URL_CATEGORY = #{urlCategory}
	    </if>
	    <if test="memNo != null and memNo != ''">
	    	AND g.MEM_NO = #{memNo}
	    </if>
        
        ORDER BY g.BOARD_NO DESC) A
        )
        WHERE RNUM &gt;= #{startRow} AND RNUM &lt;= #{endRow}
</select>

<select id="adminReplyList" resultType="com.ohot.vo.AdminCommunityReplyVO" parameterType="hashMap">
SELECT * FROM
(
    SELECT
        ROWNUM AS RNUM
        ,COUNT(1) OVER() AS total_cnt
        ,A.*
    FROM(
		SELECT G.REPLY_NO, G.REPLY_CONTENT, G.REPLY_DELYN, G.REPLY_CREATE_DT, G.BOARD_NO, G.ART_NO, G.MEM_NO, G.MEDIA_POST_NO, G.COM_PROFILE_NO, G.TK_NO, G.URL_CATEGORY,
		
		TO_CHAR(g.REPLY_CREATE_DT,'YYYY-MM-DD') AS REPLY_CREATE_DATE,
		TO_CHAR(g.REPLY_create_dt,'YYYY-MM-DD HH24:MI:SS') AS REPLY_CREATE_DT2
		
		FROM COMMUNITY_REPLY g
		WHERE 1=1
			<if test="category == 'tkY'">
				AND g.TK_NO LIKE '%'
  				AND g.TK_NO !=0
			</if>
		    <if test="category == 'mediaY'">
		    	AND G.MEDIA_POST_NO LIKE '%'
 				AND G.MEDIA_POST_NO != 0
		    </if>
		    <if test="category == 'boardY'">
		    	AND g.board_NO LIKE '%'
  				AND g.board_NO !=0
		    </if>
			<if test="urlCategory != null and urlCategory != ''">
				AND g.URL_CATEGORY = #{urlCategory}
			</if>
		    <if test="replyCreateDate != null and replyCreateDate != ''">
			   AND TRUNC(g.REPLY_CREATE_DT) = #{replyCreateDate}
		    </if>
			<if test="replyContent != null and replyContent != ''">
				AND G.REPLY_CONTENT LIKE '%' || #{replyContent} || '%'	
			</if>
			<if test="replyDelyn != null and replyDelyn != ''">
				AND G.REPLY_DELYN = #{replyDelyn}
			</if>
			<if test="replyNo != null and replyNo != ''">
				AND G.REPLY_NO = #{replyNo}
			</if>
			<if test="boardNo != null and boardNo != '' ">
				AND G.BOARD_NO = #{boardNo}
			</if>
			<if test="tkNo != null and tkNo != ''">
				AND G.TK_NO = #{tkNo}
			</if>
			<if test="mediaPostNo != null and mediaPostNo != '' ">
				AND G.MEDIA_POST_NO = #{mediaPostNo}
			</if>
			<if test="memNo != null and memNo != '' ">
				AND G.MEM_NO = #{memNo}
			</if>
		  ORDER BY g.REPLY_NO DESC) A
        )
        WHERE RNUM &gt;= #{startRow} AND RNUM &lt;= #{endRow}

</select>

<select id="getTotalReply" resultType="int" parameterType="hashMap">
	    SELECT COUNT(reply_NO)
	    FROM COMMUNITY_REPLY
	    WHERE 1=1
			<if test="category == 'tkY'">
				AND TK_NO LIKE '%'
  				AND TK_NO !=0
			</if>
		    <if test="category == 'mediaY'">
		    	AND MEDIA_POST_NO LIKE '%'
 				AND MEDIA_POST_NO != 0
		    </if>
		    <if test="category == 'boardY'">
		    	AND board_NO LIKE '%'
  				AND board_NO !=0
		    </if>
			<if test="urlCategory != null and urlCategory != ''">
				AND URL_CATEGORY = #{urlCategory}
			</if>
		    <if test="replyCreateDate != null and replyCreateDate != ''">
			   AND TRUNC(REPLY_CREATE_DT) = #{replyCreateDate}
		    </if>
			<if test="replyContent != null and replyContent != ''">
				AND REPLY_CONTENT LIKE '%' || #{replyContent} || '%'	
			</if>
			<if test="replyDelyn != null and replyDelyn != ''">
				AND REPLY_DELYN = #{replyDelyn}
			</if>
			<if test="replyNo != null and replyNo != ''">
				AND REPLY_NO = #{replyNo}
			</if>
			<if test="boardNo != null and boardNo != '' ">
				AND BOARD_NO = #{boardNo}
			</if>
			<if test="tkNo != null and tkNo != ''">
				AND TK_NO = #{tkNo}
			</if>
			<if test="mediaPostNo != null and mediaPostNo != '' ">
				AND MEDIA_POST_NO = #{mediaPostNo}
			</if>
			<if test="memNo != null and memNo != '' ">
				AND MEM_NO = #{memNo}
			</if>
</select>
</mapper>