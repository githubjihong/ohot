<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ohot.home.dm.mapper.DmMapper">
	<select id="artGroupList" resultMap="artistGroupMap" parameterType="int">
		SELECT
		    	ag.art_group_no,
		    	ag.art_group_nm,
		    	a.art_no,
		    	a.art_act_nm,
		    	f.file_save_locate
		FROM artist_group ag
		LEFT OUTER JOIN ARTIST a on(a.art_group_no = ag.art_group_no)
		LEFT OUTER JOIN (
							SELECT file_group_no, file_save_locate
						    FROM (
						    	    SELECT 
							            file_group_no, 
							            file_save_locate,
							            ROW_NUMBER() OVER (PARTITION BY file_group_no ORDER BY file_sn DESC) AS rn
							        FROM file_detail
							    )
						    WHERE rn = 1
						  ) f ON a.file_group_no = f.file_group_no
		WHERE 1=1
		AND ag.art_group_no >=1
		AND a.art_no >=1
		AND ag.art_group_no NOT IN (
							        SELECT cp.art_group_no
							        FROM community_profile cp
							        WHERE cp.mem_no = #{memNo}
							        AND cp.com_delyn='N'
							    )
		ORDER BY ag.art_group_no
	</select>
	
	<select id="myArtistList" resultMap="artistGroupMap" parameterType="int">
		SELECT
		    	ag.art_group_no,
		    	ag.art_group_nm,
		    	a.art_no,
		    	a.art_act_nm,
		    	f.file_save_locate
		FROM artist_group ag
		LEFT OUTER JOIN ARTIST a on(a.art_group_no = ag.art_group_no)
		LEFT OUTER JOIN (
							SELECT file_group_no, file_save_locate
						    FROM (
						    	    SELECT 
							            file_group_no, 
							            file_save_locate,
							            ROW_NUMBER() OVER (PARTITION BY file_group_no ORDER BY file_sn DESC) AS rn
							        FROM file_detail
							    )
						    WHERE rn = 1
						  ) f ON a.file_group_no = f.file_group_no
		WHERE 1=1
		AND ag.art_group_no >=1
		AND a.art_no >=1
		AND ag.art_group_no IN (
							        SELECT cp.art_group_no
							        FROM community_profile cp
							        WHERE cp.mem_no = #{memNo}
							        AND cp.com_delyn='N'
							        AND cp.com_auth = 'ROLE_MEM'
							    )
		ORDER BY ag.art_group_no
	</select>
	
	<resultMap type="com.ohot.vo.ArtistGroupVO" id="artistGroupMap">
		<result property="artGroupNo" column="ART_GROUP_NO"/>
		<result property="artGroupDebutYmd" column="ART_GROUP_DEBUT_YMD"/>
		<result property="artGroupNm" column="ART_GROUP_NM"/>
		<result property="artGroupNmKo" column="ART_GROUP_NM_KO"/>
		<result property="artGroupExpln" column="ART_GROUP_EXPLN"/>
		<result property="artGroupRegYmd" column="ART_GROUP_REG_YMD"/>
		<result property="artGroupDelYn" column="ART_GROUP_DEL_YN"/>
		<result property="fileGroupNo" column="FILE_GROUP_NO"/>
		<result property="logoFileGroupNo" column="LOGO_FILE_GROUP_NO"/>
		<collection property="artistVOList" resultMap="artistMap"></collection>
	</resultMap>
	
	<resultMap type="com.ohot.vo.ArtistVO" id="artistMap">
		<result property="artDelYn" column="ART_DEL_YN"/>
		<result property="artNo" column="ART_NO"/>
		<result property="artGroupNo" column="ART_GROUP_NO"/>
		<result property="artActNm" column="ART_ACT_NM"/>
		<result property="artExpln" column="ART_EXPLN"/>
		<result property="artRegYmd" column="ART_REG_YMD"/>
		<result property="fileGroupNo" column="FILE_GROUP_NO"/>
		<result property="fileSaveLocate" column="FILE_SAVE_LOCATE"/>
		<result property="memNo" column="MEM_NO"/>
		<association property="fileGroupVO" resultMap="fileGroupMap"></association>
	</resultMap>
	
	<resultMap type="com.ohot.vo.FileGroupVO" id="fileGroupMap">
		<result property="fileGroupNo" column="FILE_GROUP_NO"/>
		<result property="fileRegdate" column="FILE_REGDATE"/>
		<collection property="fileDetailVOList" resultMap="fileDetailMap"></collection>
	</resultMap>
	
	<resultMap type="com.ohot.vo.FileDetailVO" id="fileDetailMap">
		<result property="fileSn" column="FILE_SN"/>
		<result property="fileGroupNo" column="FILE_GROUP_NO"/>
		<result property="fileOriginalName" column="FILE_ORIGINAL_NAME"/>
		<result property="fileSaveName" column="FILE_SAVE_NAME"/>
		<result property="fileSaveLocate" column="FILE_SAVE_LOCATE"/>
		<result property="fileSize" column="FILE_SIZE"/>
		<result property="fileExt" column="FILE_EXT"/>
		<result property="fileMime" column="FILE_MIME"/>
		<result property="fileFancysize" column="FILE_FANCYSIZE"/>
		<result property="fileSaveDate" column="FILE_SAVE_DATE"/>
		<result property="fileDowncount" column="FILE_DOWNCOUNT"/>
	</resultMap>
	
	<resultMap type="com.ohot.home.community.vo.CommunityProfileVO" id="communityProfileMap">
		<result property="membershipYn" column="MEMBERSHIP_YN"/>
		<result property="comProfileNo" column="COM_PROFILE_NO"/>
		<result property="memNo" column="MEM_NO"/>
		<result property="comNm" column="COM_NM"/>
		<result property="comFileGroupNo" column="COM_FILE_GROUP_NO"/>
		<result property="comJoinYmd" column="COM_JOIN_YMD"/>
		<result property="comDelyn" column="COM_DELYN"/>
		<result property="comAuth" column="COM_AUTH"/>
		<result property="artGroupNo" column="ART_GROUP_NO"/>
		<association property="artistGroupVO" resultMap="artistGroupMap"></association>
	</resultMap>

</mapper>