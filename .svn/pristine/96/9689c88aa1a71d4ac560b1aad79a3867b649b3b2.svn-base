<%@ page language="java" contentType="text/html; charset=UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %>
<%@ taglib uri="http://www.springframework.org/security/tags" prefix="sec" %>

<!DOCTYPE html>
<html>
<head>
<%@include file="../header.jsp" %>
    <script type="text/javascript" src="/js/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    <script src="https://kit.fontawesome.com/your-kit-code.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<%-- <link rel="stylesheet" type="text/css" href="<%=request.getContextPath() %>/resources/static/css/bootstrap.min.css" /> --%>
<title>Ìå¨ Ïª§ÎÆ§ÎãàÌã∞</title>
    <style>
    	#endMessage {
    background-color: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
    padding: 10px;
    font-size: 16px;
    margin-top: 20px;
    text-align: center;
    font-weight: bold;
}
    body {
        background-color: #f0f2f5; /* Weverse ÎäêÎÇåÏùò Î∞∞Í≤Ω */
    }

        .top-nav {
        
            background-color: rgb(211,23,23);
            color: white;
            padding: 10px;
            text-align: center;
            font-weight: bold;
        }
        .artist-card {
            border-radius: 15px;
            padding: 15px;
            background: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        .artist-profile {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 10px;
        }
        .feed-box {
            background: white;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
        }
        .post-card {
            background: white;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-top: 15px;
        }
        .profile-img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            cursor: pointer;
            
        }
        .board-img {
            width: 200px;
            height: 200px;
            border-radius: 20%;
            object-fit: cover;
            cursor: pointer;
        }
        .post-content {
            font-size: 14px;
            color: #333;
        }
        .post-footer {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }
        .btn-like, .btn-comment {
            border: none;
            background: none;
            color: #6c757d;
            cursor: pointer;
        }
                /* Î™®Îã¨ Ïä§ÌÉÄÏùº */
        .custom-modal .modal-content {
            border-radius: 20px;
            padding: 20px;
        }
        .custom-modal .modal-header {
            border-bottom: none;
            text-align: center;
            justify-content: center;
        }
        .custom-modal .modal-title {
            font-size: 20px;
            font-weight: bold;
        }
        .custom-modal .modal-body {
            text-align: center;
        }
        .custom-textarea1 {
            width: 100%;
            min-height: 50px;
            border: none;
            background-color: #f8f9fa;
            resize: none;
            padding: 15px;
            font-size: 16px;
            border-radius: 10px;
            outline: none;
        }
        .custom-textarea2 {
            width: 100%;
            min-height: 300px;
            border: none;
            background-color: #f8f9fa;
            resize: none;
            padding: 15px;
            font-size: 16px;
            border-radius: 10px;
            outline: none;
        }
        .custom-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .btn-custom {
            background-color: #1c1c1c;
            color: white;
            border-radius: 8px;
            padding: 8px 20px;
        }
    .btn-weverse {
        background-color: white;
        color: #6d8f38;
        font-size: 16px;
        font-weight: bold;
        border: 2px solid #6d8f38;
        border-radius: 25px;
        padding: 12px;
        width: 100%;
        display: block;
        text-align: center;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    .btn-weverse:hover {
        background-color: #6d8f38;
        color: white;
    }
        .btn-custom:disabled {
            background-color: #ccc;
        }
        .icon-btn {
            font-size: 24px;
            cursor: pointer;
            margin-right: 10px;
        }
        .dropdown-menu {
    border-radius: 12px;
    box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.15);
}
.dropdown-item {
    font-size: 14px;
    font-weight: 500;
}
.badge-artist {
    display: inline-block;
    padding: 3px 8px;
    font-size: 12px;
    font-weight: bold;
    color: white;
    background: linear-gradient(45deg, #FF1493, #FF69B4); /* ÌïëÌÅ¨ Í∑∏ÎùºÎç∞Ïù¥ÏÖò */
    border-radius: 8px;
}
.me-2{
	cursor:pointer;
}
    </style>
</head>
<body>
<sec:authorize access="isAuthenticated()">
   <sec:authentication property="principal.usersVO" var="userVO"/>
</sec:authorize>
<div class="row mt-5"></div>
<form id="artGroupInfo" name="artGroupInfo" >
<input type="hidden" id="artGroupNo" name="artGroupNo" value="${communityProfileVO.artGroupNo }">
<input type="hidden" id="memNo" name="memNo" value="${communityProfileVO.memNo }">
<input type="hidden" id="comProfileNo" name="comProfileNo" value="${communityProfileVO.comProfileNo }">
<input type="hidden" id="comNm" name="comNm" value="${communityProfileVO.comNm }">
<input type="hidden" id="saveFileLocate" name="saveFileLocate" value="${communityProfileVO.fileGroupVO.fileDetailVOList[0].fileSaveLocate }">
<input type="hidden" id="userNo" name="userNo" value="${userVO.userNo }">
<input type="hidden" id="authNm" name="authNm" value="${userVO.userAuthList[0].authNm }">
</form>
${userVO }
${communityProfileVO }
<div class="top-nav">Fan</div>
<div class="container mt-4">
    <div class="row">
        <!-- ÏïÑÌã∞Ïä§Ìä∏ Ïπ¥Îìú -->
        <div class="col-md-8 mx-auto">
            <div class="d-flex justify-content-between">
                
                <div class="artist-card">
                    <img src="/images/artist1.jpg" class="artist-profile">
                    <p class="fw-bold">MOON SUA <span class="text-primary">‚úî</span></p>
                    <p>„Öã„Öã„Öã„Öã„Öã„Öã„Öã„Öã„Öã„Öã„Öã„Öã„Öã„Öã„Öã„Öã„Öã„Öã„Öã</p>
                </div>
                <div class="artist-card">
                    <img src="/images/artist2.jpg" class="artist-profile">
                    <p class="fw-bold">MOON SUA <span class="text-primary">‚úî</span></p>
                    <p>30Î∂Ñ Îí§Ïóê ÎßåÎÇòÏöî üíú</p>
                </div>
                <div class="artist-card">
                    <img src="/images/artist3.jpg" class="artist-profile">
                    <p class="fw-bold">SUHYEON <span class="text-primary">  </span></p>
                    <p>ÏßÑÏßúÎ°ú...? Íµ¨Í∏ÄÏóêÏÑú Í∞ÄÏ†∏Ïò® Í≤å ÏïÑÎãàÎùº...?</p>
                   
                </div>
            </div>
        </div>
    </div>
   

    <!-- ÎåìÍ∏Ä Î™®Îã¨ Î≤ÑÌäº -->


    <!-- ÎåìÍ∏Ä Î™®Îã¨ -->
    <div class="modal fade" id="replyModal" tabindex="-1" aria-labelledby="replyModalLabel" aria-hidden="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="replyModalLabel">ÎåìÍ∏Ä</h5>
                    
                    <button type="button" class="btn-close" data-bs-dismiss="modal" id="modal_close" onclick="fn_reply_modal_close()" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="replyList"></div>
                </div>

            </div>
        </div>
    </div>
    <!-- ÎéÉÍ∏Ä Î™®Îã¨ ÎÅù -->
    

    <!-- Í≤åÏãúÎ¨º ÏûÖÎ†• Ï∞Ω -->
    	<div class="container mt-4">
	    	<div class="col-md-8 mx-auto">
	    	<c:if test="${(userVO.userNo == communityProfileVO.memNo) && (userVO.userAuthList[0].authNm=='ROLE_MEM') && ((communityProfileVO.comProfileNo!=0) && (communityProfileVO.comProfileNo!=null))}">
	           <button class="btn-weverse" data-bs-toggle="modal" data-bs-target="#postModal">Ìè¨Ïä§Ìä∏ Ïì∞Í∏∞</button>
	        </c:if>   
			</div>
		</div>
</div>
<!-- Î™®Îã¨ -->
<div class="modal fade custom-modal" id="postModal" tabindex="-1" aria-labelledby="postModalLabel" aria-hidden="false">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <!-- Î™®Îã¨ Ìó§Îçî -->
			
            <div class="modal-header">
                <h5 class="modal-title" id="postModalLabel">Ìè¨Ïä§Ìä∏ Ïì∞Í∏∞</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
			
            <!-- Î™®Îã¨ Î∞îÎîî -->
            
            	<form name="frm" action="/oho/community/addBoard" method="post" enctype="multipart/form-data">

				<input type="hidden" id="artGroupNo" name="artGroupNo" value="${communityProfileVO.artGroupNo }">
				<input type="hidden" id="memNo" name="memNo" value="${communityProfileVO.memNo }">
				<input type="hidden" id="comProfileNo" name="comProfileNo" value="${communityProfileVO.comProfileNo }">
				<input type="hidden" id="comProfileNo" name="comProfileVO" value="${communityProfileVO }">

	            <div class="modal-body">
	            	<input type="text" class="form-control mb-3" id="boardTitle" name="boardTitle" placeholder="Ï†úÎ™©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî" />
	                <input type="text" class="custom-textarea2" id="boardContent" name="boardContent" placeholder="ÏúÑÎ≤ÑÏä§Ïóê ÎÇ®Í≤®Î≥¥ÏÑ∏Ïöî..." oninput="toggleSubmitButton()"></input>
	                
	            </div>
				
	            <!-- Î™®Îã¨ Ìë∏ÌÑ∞ -->
	            <div class="modal-footer custom-footer">
                <div>
                      <label for="formFile" class="form-label"></label>
 					  <input class="form-control" type="file" id="formFile"  multiple  name="uploadFile">
                </div>
                <div>
                <input type="checkbox" name="boardOnlyFan"  value="Y" />Hide from Artists
                </div>
                <button type="button" class="btn btn-custom" id="submitBtn" onclick="fn_board_add_submit()" disabled>Îì±Î°ù</button>
                </div>
                </form>
            
        </div>
    </div>
</div>

<!-- Í≤åÏãúÍ∏Ä ÏàòÏ†ï Î™®Îã¨ -->
<div class="modal fade custom-modal" id="postEditModal" tabindex="-1" aria-labelledby="postModalLabel" aria-hidden="false">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <!-- Î™®Îã¨ Ìó§Îçî -->
			
            <div class="modal-header">
                <h5 class="modal-title" id="postModalLabel">Ìè¨Ïä§Ìä∏ Ïì∞Í∏∞</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
			
            <!-- Î™®Îã¨ Î∞îÎîî -->
            
            	<form name="boardEditForm" action="/oho/community/editBoard" method="post" enctype="multipart/form-data">

				<input type="hidden" id="artGroupNo" name="artGroupNo" value="${communityProfileVO.artGroupNo }">
				<input type="hidden" id="memNo" name="memNo" value="${communityProfileVO.memNo }">
				<input type="hidden" id="comProfileNo" name="comProfileNo" value="${communityProfileVO.comProfileNo }">
				<input type="hidden" id="comProfileVo" name="comProfileVO" value="${communityProfileVO }">
				<input type="hidden" id="editBoardNo" name="boardNo" value="">
				
	            <div class="modal-body">
	            	<input type="text" class="form-control mb-3" id="boardEditTitle" name="boardTitle" placeholder="Ï†úÎ™©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî" />
	                <input type="text" class="custom-textarea2" id="boardEditContent" name="boardContent" placeholder="ÏúÑÎ≤ÑÏä§Ïóê ÎÇ®Í≤®Î≥¥ÏÑ∏Ïöî..."></input>
	                <div id="editImg">
                	</div>
	            </div>
				
	            <!-- Î™®Îã¨ Ìë∏ÌÑ∞ -->
	            <div class="modal-footer custom-footer">
                <div>
                      <label for="formFile" class="form-label"></label>
 					  <input class="form-control" type="file" id="formFile" onchange="readFile(this)" onclick="fn_edit_img_remove()" multiple  name="uploadFile">
                </div>

                <div>
                <input type="checkbox" name="boardOnlyFan"  value="Y" />Hide from Artists
                </div>
                <button type="button" class="btn btn-custom" id="submitBtn" onclick="fn_board_edit_submit()" >Îì±Î°ù</button>
                </div>
                </form>
            
        </div>
    </div>
</div>
<!-- Ïù¥ÎØ∏ÏßÄ ÌÅ¨Í≤å Î≥¥Ïù¥Í≤å ÌïòÎäî Î™®Îã¨  -->
<div class="modal fade" id="imageModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body text-center">
        <img id="modalImage" src="" class="img-fluid">
      </div>
    </div>
  </div>
</div>
<c:choose>
	
    <c:when test="${(userVO.userNo == communityProfileVO.memNo) && (userVO.userAuthList[0].authNm=='ROLE_MEM') && (communityProfileVO.comProfileNo==0)}">
        <!-- ÎπÑÌöåÏõêÏö© UI -->
        <div class="container text-center mt-4">
            <div class="alert alert-dark d-flex flex-column align-items-center p-4">
                <h5 class="fw-bold">Ïª§ÎÆ§ÎãàÌã∞Ïóê Í∞ÄÏûÖÌï¥ Îçî ÎßéÏùÄ Í∏∞Îä•ÏùÑ ÏÇ¨Ïö©Ìï¥Î≥¥ÏÑ∏Ïöî!</h5>

                <a href="/oho/community/join?memNo=${communityProfileVO.memNo }&artGroupNo=${communityProfileVO.artGroupNo}" class="btn btn-success rounded-pill px-4">Ïª§ÎÆ§ÎãàÌã∞ Í∞ÄÏûÖ</a>
            </div>
        </div>
    </c:when>
    <c:otherwise>
        <!-- Î°úÍ∑∏Ïù∏Ìïú ÏÇ¨Ïö©ÏûêÏóêÍ≤åÎßå Î≥¥Ïù¥Îäî UI -->
        <div class="container text-center mt-4">
            <h5 class="fw-bold">ÌôòÏòÅÌï©ÎãàÎã§, ${communityProfileVO.comNm}Îãò!</h5>
        </div>
    </c:otherwise>
</c:choose>
<h1 style="text-align: center; margin-bottom : 20px"></h1>
<div class="container mt-4" id="divBoards">
<!--Í≤åÏãúÍ∏ÄÏù¥ ÏåìÏù¥Îäî Í≥≥  -->
</div>
<div id="endMessage" style="display:none; text-align: center; font-size: 16px; color: black;">
    <strong>ÎßàÏßÄÎßâ Í≤åÏãúÍ∏Ä ÏûÖÎãàÎã§</strong>
</div>


<script type="text/javascript">
//ÏûêÎ∞îÏóêÏÑú Îã¥ÏïÑÏÑú Î≥¥ÎÇ∏(join) Í∞í Î∞è principleÏóê Îì§Ïñ¥ÏûàÎäî Í∞í
let artGroupNo = $("form[name='artGroupInfo']").find('#artGroupNo').val();
let myComProfileNo = $("form[name='artGroupInfo']").find('#comProfileNo').val();
let memNo =  $("form[name='artGroupInfo']").find('#memNo').val();
let comNm = $("form[name='artGroupInfo']").find('#comNm').val();
let userNo = $("form[name='artGroupInfo']").find('#userNo').val();
let authNm = $("form[name='artGroupInfo']").find('#authNm').val();
let mySaveFileLocate = $("form[name='artGroupInfo']").find('#saveFileLocate').val();
	let currentPage =1;
	let isLastPage = false;

	
	function fn_edit_img_remove(){
		let fileInput = document.getElementById("formFile");

            
                $("#editImg").empty();
                console.log("-=-0-0-0-0-fileInput: ",fileInput);

		
	}
	
	//Í≤åÏãúÍ∏Ä ÏàòÏ†ï Ïãú Í∏∞Ï°¥ Í≤åÏãúÍ∏Ä ÎÇ¥Ïö© ÏïÑÏûëÏä§Î°ú Î∞õÏïÑÏò§Îäî Í≥≥
	function fn_post_edit(boardNo){
		let data ={
				"boardNo":boardNo
		}
		let url="/oho/community/editFanBoardAjax?boardNo="+boardNo;
		$.ajax({
			url:url,
			contentType:"application/json; charset=utf-8",
			dataType:"json",
			type:"get",
			success: function(communityPostVO){
				
				$("#boardEditTitle").val(communityPostVO.boardTitle);
				$("#boardEditContent").val(communityPostVO.boardContent);
				
				let str="";
				
				if(communityPostVO.fileGroupVO?.fileDetailVOList?.length>0){
					$.each(communityPostVO.fileGroupVO.fileDetailVOList,function(idx,fileDetailVO){
			            str += `<img src="/upload\${fileDetailVO.fileSaveLocate}" class="board-img" onclick="openImageModal(this.src)" />`;
					});
				}
				console.log("str : ",str);
				$("#editImg").html(str);
				$("#editBoardNo").val(boardNo);
			}
		})
	}
	
	

	
	//ÎåìÍ∏Ä ÏÇ≠Ï†úÌïòÍ∏∞
	function fn_delete_reply(replyNo,boardNo){
		
		let data = {
			"replyNo":replyNo,
			"boardNo":boardNo

		};
		let url="/oho/community/deleteReply?replyNo="+replyNo+"&boardNo="+boardNo;
		$.ajax({
			url:url,
			contentType:"aplication/json; charset=utf-8",
			type:"get",
			dataType:"json",
			success: function(replyCnt){
				console.log("ÏÑ±Í≥µÌñáÎãà?",replyCnt);
				let str =`\${replyCnt}`;
				$(`#repCnt\${boardNo}`).html((str));
				$(`#replyNumber\${replyNo}`).remove();
			},
			error : function(){
				alert('error');
			}
			
			})
		
	}
	//Î™®Îã¨ Ï∑®ÏÜåÏãú ÏûÖÎ†•Í∞í Ï¥àÍ∏∞Ìôî
	$(document).ready(function(){
		$("#postModal").on("hidden.bs.modal", function () {
		    document.forms["frm"].reset();
		    document.getElementById("submitBtn").disabled = true;
		});
	});
	//Í≤åÏãúÍ∏Ä ÏàòÏ†ï Î™®Îã¨ Ï∑®ÏÜåÏãú ÏûÖÎ†•Í∞í Ï¥àÍ∏∞Ìôî
	$(document).ready(function(){
		$("#postEditModal").on("hidden.bs.modal", function () {
		    document.forms["boardEditForm"].reset();
		    document.getElementById("submitBtn").disabled = true;
		});
	});
	//ÌÅ¥Î¶≠Ïãú ÏÇ¨ÏßÑ ÌÅ¨Í≤å Î≥¥Ïù¥Í≤åÌïòÎäî Í∏∞Îä•
	  function openImageModal(src) {
		    document.getElementById("modalImage").src = src;
		    new bootstrap.Modal(document.getElementById('imageModal')).show();
		  }
	  
	//Ï†úÎ™©Í≥º ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•ÌïòÏßÄ ÏïäÏúºÎ©¥
	function toggleSubmitButton() {
	    const textArea = document.getElementById("boardContent");
	    const textArea2 = document.getElementById("boardTitle");
	    const submitBtn = document.getElementById("submitBtn");

	    if (textArea.value.trim() !== "" && textArea2.value.trim() !== "") {
	        submitBtn.disabled = false;
	    } else {
	        submitBtn.disabled = true;
	    }
	}

	//Í≤åÏãúÎ¨º ÏàòÏ†ï
	function fn_board_edit_submit(){
		$("form[name='boardEditForm']").submit();
	}	
	
//Í≤åÏãúÎ¨º Ï∂îÍ∞Ä submit
	function fn_board_add_submit() {
		$("form[name='frm']").submit();
	}

//ÎåìÍ∏Ä Ï¢ãÏïÑÏöî	
function fn_reply_likeYn(boardNo,replyNo){
	let data = {
			"comProfileNo":myComProfileNo,
			"replyNo":replyNo,
			"boardNo":boardNo
            
	};
	let url="/oho/community/replyLikeYnAjax?"+$.param(data);
	console.log("data : ",data);
	
	 $.ajax({
			url:url,
			contentType:"application/json; charset=utf-8",
			type:"get",
			dataType:"json"
    , success: function(replyLikeCnt) {
 	    console.log("replyLikeCnt ÏÑ±Í≥µÌñàÏäµÎãàÎã§ ", replyLikeCnt);
 	   
 	    let str =`\${replyLikeCnt}`;
 	  $(`#replyLikeCnt\${replyNo}`).html(str);
 	},
		error : function() {
         alert('error');
   },
   complete¬†:¬†function()¬†{¬†¬†¬†¬†¬†¬†¬†
	 	replyToggleLike(boardNo,replyNo);
 	 ¬†}
	 }); //ajax
}
//ÎåìÍ∏Ä Ï¢ãÏïÑÏöî ÌÜ†Í∏Ä
function replyToggleLike(boardNo,replyNo) {
    let replyLikeBtn = document.getElementById(`replyLikeBtn\${replyNo}`);
    let heartIcon = document.getElementById(`heartIcon\${replyNo}`);
    console.log(heartIcon);
	console.log("Îì§Ïñ¥Ïò§Í≥† ÏûàÎãà?",replyNo);
    let isLiked = heartIcon.classList.contains("bi-heart-fill");

    if (isLiked) {
        heartIcon.classList.remove("bi-heart-fill");
        heartIcon.classList.add("bi-heart");
        replyLikeBtn.classList.remove("btn-danger");
        replyLikeBtn.classList.add("btn-outline-danger");

    } else {
        heartIcon.classList.remove("bi-heart");
        heartIcon.classList.add("bi-heart-fill");
        replyLikeBtn.classList.remove("btn-outline-danger");
        replyLikeBtn.classList.add("btn-danger");

    }
}	

//Í≤åÏãúÎ¨º Ï¢ãÏïÑÏöî ÌÜ†Í∏Ä
function fn_board_likeYn(boardNo){
	

	
	
	let data = {
			"comProfileNo":myComProfileNo,
			"boardNo":boardNo

	};
	let url="/oho/community/boardLikeYnAjax?"+$.param(data);
	console.log("data : ",data);
	
	 $.ajax({
			url:url,
			contentType:"application/json; charset=utf-8",
			type:"get",
			dataType:"json"
    , success: function(boardLikeCnt) {
 	    console.log("boardLikeCnt ÏÑ±Í≥µÌñàÏäµÎãàÎã§ ", boardLikeCnt);
 	   
 	    let str =`\${boardLikeCnt}`;
 	  $(`#boardLikeCnt\${boardNo}`).html(str);
 	  
 	},
		error : function() {
         alert('error');
   },
   complete¬†:¬†function()¬†{¬†¬†¬†¬†¬†¬†¬†
	 	toggleLike(boardNo);
  	 ¬†}
	 }); //ajax
}
//ÌÜ†Í∏Ä Ï†ïÏùò -> ÎπàÌïòÌä∏ ÌïòÌä∏ Ïú†Î¨¥ Ï≤¥ÌÅ¨Ìï¥ÏÑú Î≥ÄÌôî ( Î∂ÄÌä∏Ïä§Ìä∏Îû© 5 Í∏∞Îä• )
function toggleLike(boardNo) {
    let boardLikeBtn = document.getElementById(`boardLikeBtn\${boardNo}`);
    let heartIcon = document.getElementById(`heartIcon\${boardNo}`);
    console.log(heartIcon);
	console.log("Îì§Ïñ¥Ïò§Í≥† ÏûàÎãà?",boardNo);
    let isLiked = heartIcon.classList.contains("bi-heart-fill");

    if (isLiked) {
        heartIcon.classList.remove("bi-heart-fill");
        heartIcon.classList.add("bi-heart");
        boardLikeBtn.classList.remove("btn-danger");
        boardLikeBtn.classList.add("btn-outline-danger");

    } else {
        heartIcon.classList.remove("bi-heart");
        heartIcon.classList.add("bi-heart-fill");
        boardLikeBtn.classList.remove("btn-outline-danger");
        boardLikeBtn.classList.add("btn-danger");

    }
}	
	
	//ÎåìÍ∏Ä Ï∂îÍ∞Ä
function fn_add_replies(boardNo){
	
	let replyContent =$(`#replyContent\${boardNo}`).val();
	console.log("replyContent",replyContent);
	console.log("memNo",memNo);
	let data ={
			"artGroupNo":artGroupNo,
			"boardNo":boardNo,
			"comProfileNo":myComProfileNo,
			"replyContent":replyContent,
			"comNm":comNm,
			"memNo":memNo
		};
		
		let url = "/oho/community/addReplyAjax?"+$.param(data);
		console.log("data : ",data);
		 $.ajax({
				url:url,
				contentType:"application/json; charset=utf-8",
				type:"get",
				dataType:"json"
	       , success: function(communityReplyVO) {
	    	    console.log("communityReplyVO: ", communityReplyVO);
	    	    console.log("mySaveFileLocate: ", mySaveFileLocate);
	    	    
	    	    let str = "";
 	    	    str += `
	    	        <div class="d-flex align-items-start mb-2" id="\${communityReplyVO.replyNo}">`;
	    	           
	    	        
                if(mySaveFileLocate.length > 0){
                    
					
                        str += `<img src="/upload\${mySaveFileLocate}" class="profile-img" onclick="openImageModal(this.src)" />`;
				
                        
            	}else{       	
                	str += ``;
                };
                if(communityReplyVO.memNo==userNo){

                	
                	str+=`                <!-- ÎìúÎ°≠Îã§Ïö¥ Ïª®ÌÖåÏù¥ÎÑà -->
                		<div class="position-absolute top-1 end-0">
                        <div class="dropdown">
                        <!-- Ï†ê 3Í∞ú Î≤ÑÌäº -->
                        <button class="btn btn-light border-0" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                            &#x22EE; <!-- Ï†ê 3Í∞ú ÏïÑÏù¥ÏΩò (ÏÑ∏Î°ú) -->
                        </button>
                        
                        <!-- ÎìúÎ°≠Îã§Ïö¥ Î©îÎâ¥ -->
                        <ul class="dropdown-menu shadow-sm border-0" aria-labelledby="dropdownMenuButton">
                            <li>
                                <a class="dropdown-item d-flex align-items-center text-danger" onclick="fn_delete_reply(\${communityReplyVO.replyNo},\${communityReplyVO.boardNo})">
                                    <span class="me-2">üóëÔ∏èÏÇ≠Ï†úÌïòÍ∏∞</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                    </div>
                			
                	`;
                	
                }
                else{
                	str+=`
                		<div class="position-absolute top-1 end-0">
                		<div class="dropdown">
                        <!-- Ï†ê 3Í∞ú Î≤ÑÌäº -->
                        <button class="btn btn-light border rounded-circle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                            &#x22EE; <!-- Ï†ê 3Í∞ú ÏïÑÏù¥ÏΩò (ÏàòÏßÅ) -->
                        </button>
                        
                        <!-- ÎìúÎ°≠Îã§Ïö¥ Î©îÎâ¥ -->
                        <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                            <li>
                                <a class="dropdown-item d-flex align-items-center" href="#">
                                    <span class="me-2">üîî</span> Ïã†Í≥†ÌïòÍ∏∞
                                </a>
                            </li>
                        </ul>
                    </div>
                	</div>		
                	`;
                } 
                
                str +=   `  <div><strong><a href="/oho/community/profileDetail?comProfileNo=\${communityReplyVO.comProfileNo}" class="text-dark text-decoration-none fw-bold">
	    	                        \${communityReplyVO.comNm}
	    	                    </a></strong>
	    	                    <p id="repCreateDt">Î∞©Í∏à</p>
	    	                <p class="mb-1">\${communityReplyVO.replyContent}</p>`;
	    	                
	    	              
	    	    str +=   `      <button class="btn btn-outline-danger" id="replyLikeBtn\${communityReplyVO.replyNo}" onclick="fn_reply_likeYn(\${communityReplyVO.boardNo}, \${communityReplyVO.replyNo})">
                    			 <i id="heartIcon\${communityReplyVO.replyNo}" class="bi bi-heart"></i> <span id="replyLikeCnt\${communityReplyVO.replyNo}">\${communityReplyVO.replyLikeCnt}</span>
	    	                    </button>
	    	                </div>
	    	            </div>
	    	       
	    	    `;

	    	    console.log(str);
			
	    	    // Î∞îÎ°ú fn_page()Î°ú Îç∞Ïù¥ÌÑ∞ Ï†ÑÎã¨ÌïòÏó¨ Ï∂úÎ†•
	    	   $(`#replyList\${boardNo}`).prepend(str);
	    	    
	    	},
			error : function() {
	            alert('error');
	      },complete : function(communityReplyVO){
              let replyInput = document.querySelector(`#replyContent\${boardNo}`);
	    	  replyInput.value="";
	    	  
	    	  
	    	  console.log("========",communityReplyVO.responseJSON);
			  let repCnt = $(`#repCnt\${communityReplyVO.responseJSON.boardNo}`).html();
			  console.log("repCnt:Í≤åÏãúÎ¨º Îãπ ÎåìÍ∏Ä Í∞ØÏàò:",repCnt);
              let cnt = parseInt(repCnt);
              $(`#repCnt\${communityReplyVO.responseJSON.boardNo}`).html(cnt+1);
	      }
	
		 }); //ajax
	}
	
//ÎåìÍ∏Ä Î™®Îã¨	
function fn_load_replies(boardNo) {
     //ÌÜ†Í∏Ä Î∞©ÏãùÏúºÎ°ú ÎåìÍ∏Ä Î≥¥ÏòÄÎã§ ÏïàÎ≥¥ÏòÄÎã§ ÌïòÍ∏∞
/* 	$(`#\${boardNo}`).toggle();
	$(`#repCnt\${boardNo}`).toggle(); */
	console.log("Ïò§Í≥†ÏûàÎãà?",boardNo)
    document.getElementById("replyModalLabel").textContent = `Í≤åÏãúÍ∏Ä\${boardNo}`;
    let reply = document.getElementById(`\${boardNo}`);
    
    $("#replyList").html(reply.innerHTML);
    
    console.log("Î¶¨Ìîå?",reply)
    
	
    
    new bootstrap.Modal(document.getElementById('replyModal')).show();
	
	
    
}
//Í≤åÏãúÎ¨º Î¶¨Ïä§Ìä∏ ajax 
function fn_board_list(currentPage,keyword){
	if(currentPage==""||currentPage==null||currentPage== undefined){
	      currentPage = "1";
	   }
	   //ÌôïÏû•ÏÑ± ÌÇ§ÏõåÎìú Í≤ÄÏÉâ
  if(keyword==""||keyword==null||keyword== undefined){
        keyword = "";
  }
  //Í≤åÏãúÍ∏Ä Î¶¨Ïä§Ìä∏ ÏïÑÏûëÏä§Î°ú Î∞õÍ∏∞
let data ={
		"artGroupNo":artGroupNo,
		"currentPage":currentPage,
		"keyword":keyword
	};
	let url = "/oho/community/fanBoardListPost?currentPage=" + currentPage;
	console.log("data : ",data);
	 $.ajax({
			url:url,
			contentType:"application/json; charset=utf-8",
			data:JSON.stringify(data),
			type:"post",
			dataType:"json"
       , success: function(boardPage) {
    	    console.log("boardPage:", boardPage);
    	    console.log("boardPage.content:", boardPage.content);
    	    let boardListVO = boardPage.content;
    	    isLastPage = boardPage.isLastPage;
            if (isLastPage) {
                $('#endMessage').show();  // ÎßàÏßÄÎßâ ÌéòÏù¥ÏßÄ ÎèÑÎã¨ Ïãú Î©îÏãúÏßÄ ÌëúÏãú
            }
    	    console.log("boardListVO:", boardListVO);

    	    // Î∞îÎ°ú fn_page()Î°ú Îç∞Ïù¥ÌÑ∞ Ï†ÑÎã¨ÌïòÏó¨ Ï∂úÎ†•
    	    fn_page(boardListVO);
    	},
		error : function() {
            alert('error');
      },
     complete¬†:¬†function()¬†{¬†¬†¬†¬†¬†¬†¬†
    	 	
    	 ¬†}
	 }); //ajax
     
}
//divÏóê ÎøåÎ†§Ï£ºÎäî Î∂ÄÎ∂Ñ
function fn_page(boardListVO){
    
    // Îç∞Ïù¥ÌÑ∞ Íµ¨Ï°∞ ÌôïÏù∏
    console.log("userNo:",userNo);
	console.log("fn_page->boardListVO : ", boardListVO);
/* ÎåìÍ∏Ä Ï¢ãÏïÑÏöî Î≤ÑÌäº, Í≤åÏãúÍ∏Ä Ï¢ãÏïÑÏöî Î≤ÑÌäº ÎàÑÎ•¥Îäî ÌéëÏÖò ÎßåÎì¨ ( Ï≤òÎ¶¨Ìï¥ÏïºÌï® )
    Ï¢ãÏïÑÏöî ÎàÑÎ•∏ Í≤åÏãúÍ∏Ä - > Î≤ÑÌäº Îã§Î•¥Í≥† Ï∑®ÏÜåÌïòÎ©¥ Îòê Îã§Î•¥Í≤å Ìï¥ÏïºÌï®
    */
    let str = "";
    
    /* element
    {
    "boardNo": 3,
    "boardTitle": "ÌÖåÏä§Ìä∏3",
    "boardContent": "user->4",
    "boardOnlyMembership": "N",
    "boardDelyn": "N",
    "boardCreateDt": "2025-04-01T06:05:07.000+00:00",
    "boardOnlyFan": "N",
    "urlCategory": null,
    "comProfileNo": 4,
    "memNo": 3,
    "comNm": "IUÌÖåÏä§Ìä∏Ïö©Í≥ÑÏ†ï",
    "fileGroupNo": 0,
    "fileGroupVO": {{...
    */
    $.each(boardListVO, function(i, element) {
        
     	console.log("check : ",element.fileGroupVO);
    	console.log("Í∂åÌïú Ï≤¥ÌÅ¨ : ",element.boardOnlyFan,authNm);
		if(((element.boardOnlyFan == 'Y' && authNm == 'ROLE_MEM') 
		           || (element.boardOnlyFan == 'N' && authNm == 'ROLE_MEM') 
		           || (element.boardOnlyFan == 'N' && authNm == 'ROLE_ART'))
		           && element.boardDelyn == 'N'){
        str += `

        <div class="col-md-8  mx-auto">
            <div class="card shadow-sm rounded">
                <div class="card-header bg-white d-flex align-items-center">

                    
                        <img src="/upload\${element.fileGroupVO2.fileDetailVOList[0].fileSaveLocate}" class="profile-img" onclick="openImageModal(this.src)">
                   		
                    <div style="display: flex; gap: 20px;">
                    <a href="/oho/community/profileDetail?comProfileNo=\${element.comProfileNo}" class="text-dark text-decoration-none fw-bold"><h5 class="card-title fw-bold"><strong>\${element.comNm}</strong></h5></a>
                    <p><h3>       \${element.boardTitle}</h3></p>
                    </div>`;
        if(element.memNo==userNo){

        	
            str+=`                <!-- ÎìúÎ°≠Îã§Ïö¥ Ïª®ÌÖåÏù¥ÎÑà -->
            		<div class="position-absolute top-1 end-0">
                    <div class="dropdown">
                    <!-- Ï†ê 3Í∞ú Î≤ÑÌäº -->
                    <button class="btn btn-light border-0" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                        &#x22EE; <!-- Ï†ê 3Í∞ú ÏïÑÏù¥ÏΩò (ÏÑ∏Î°ú) -->
                    </button>
                    
                    <!-- ÎìúÎ°≠Îã§Ïö¥ Î©îÎâ¥ -->
                    <ul class="dropdown-menu shadow-sm border-0" aria-labelledby="dropdownMenuButton">
                        <li>
                            <a class="dropdown-item d-flex align-items-center" onclick="fn_post_edit(\${element.boardNo})" data-bs-toggle="modal" data-bs-target="#postEditModal">
                                <span class="me-2">‚úèÔ∏èÏàòÏ†ïÌïòÍ∏∞</span> 
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item d-flex align-items-center text-danger" href="/oho/community/deleteBoard?boardNo=\${element.boardNo}&comProfileNo=\${myComProfileNo}">
                                <span class="me-2">üóëÔ∏èÏÇ≠Ï†úÌïòÍ∏∞</span> 
                            </a>
                        </li>
                    </ul>
                </div>
                </div>
            			
            	`;
            	
            }
        else{
        	str+=`
        		<div class="position-absolute top-1 end-0">
        		<div class="dropdown">
                <!-- Ï†ê 3Í∞ú Î≤ÑÌäº -->
                <button class="btn btn-light border rounded-circle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                    &#x22EE; <!-- Ï†ê 3Í∞ú ÏïÑÏù¥ÏΩò (ÏàòÏßÅ) -->
                </button>
                
                <!-- ÎìúÎ°≠Îã§Ïö¥ Î©îÎâ¥ -->
                <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                    <li>
                        <a class="dropdown-item d-flex align-items-center" href="#">
                            <span class="me-2">üîî</span> Ïã†Í≥†ÌïòÍ∏∞
                        </a>
                    </li>
                </ul>
            </div>
        	</div>		
        	`;
        }

          str+=`     </div>
                <div class="card-body">
                <p id="boardCreateDt">\${element.boardCreateDate}</p>
                `;

                
                    
                if(element.fileGroupVO?.fileDetailVOList?.length > 0){
                      
					$.each(element.fileGroupVO.fileDetailVOList,function(idx,fileDetailVO){
                        str += `<img src="/upload\${fileDetailVO.fileSaveLocate}" class="board-img" onclick="openImageModal(this.src)" />`;
					});
                        
            	}else{       	
                	str += ``;
                };
                
                str += `<p class="card-text">\${element.boardContent}</p>
                </div>
                <div class="card-footer bg-white d-flex justify-content-between align-items-center">
                    <button class="btn btn-outline-danger" id="boardLikeBtn\${element.boardNo}" onclick="fn_board_likeYn(\${element.boardNo})">`;
                 str+=`<i id="heartIcon\${element.boardNo}" class="bi bi-heart`;
                $.each(element.boardLikeList,function(idx,boardLike){
                	if(boardLike.memNo==memNo){
                		str+=`-fill`;
                		
                		} 
                });
               str+=`"></i>`;
                   
                    
              str+=`<span id="boardLikeCnt\${element.boardNo}">\${element.boardLikeCnt}</span>
                    </button>`;

            //ÎåìÍ∏Ä Î™®Îã¨ Ïä§ÌÉÄÌä∏        
            str+= ` 
                    <button class="btn btn-light" onclick="fn_load_replies(\${element.boardNo})">
                    üí¨ ÎåìÍ∏Ä(<span id="repCnt\${element.boardNo}">\${element.replyList.length}</span>)
                    </button>
                	`;    
                    
        	str+=`  </div>
                <div class="comment-section p-3 bg-light rounded" id="\${element.boardNo}" style="display: none;">
                    <div class="input-group">
                        <input type="text" id="replyContent\${element.boardNo}" class="form-control" placeholder="ÎåìÍ∏ÄÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
                        <button class="btn btn-primary" onclick="fn_add_replies(\${element.boardNo})">Îì±Î°ù</button>
                    </div>
                    <div id="replyList\${element.boardNo}" class="mt-3">`;
                    
                    if (!element.replyList || element.replyList.length <= 0) {
                        str += `<p class="text-muted text-center">ÎåìÍ∏ÄÏù¥ ÏóÜÏäµÎãàÎã§.</p>`;
                    } else {
                        element.replyList.forEach(reply => {
                        	
                        	if(reply.replyDelyn=='N'){
                            str += `
                            	
                            <div id="replyNumber\${reply.replyNo}">
                            <div class="d-flex align-items-start mb-2">
                            	 <img src="/upload\${reply.fileGroupVO.fileDetailVOList[0].fileSaveLocate}" class="profile-img" onclick="openImageModal(this.src)">    
                                <div>
                                    <strong><a href="/oho/community/profileDetail?comProfileNo=\${reply.comProfileNo}" class="text-dark text-decoration-none fw-bold">\${reply.comNm}</a>`;
                            if(reply.comAuth=='ROLE_ART'){
                                str+=`<span class="badge-star">üéµ</span>`;        
                                        }  
                              str+=`</strong>`;
                             
                              /* Ïó¨Í∏∞ */
                              if(reply.memNo==userNo){

                              	
                              	str+=`                <!-- ÎìúÎ°≠Îã§Ïö¥ Ïª®ÌÖåÏù¥ÎÑà -->
                              		<div class="position-absolute top-1 end-0">
                                      <div class="dropdown">
                                      <!-- Ï†ê 3Í∞ú Î≤ÑÌäº -->
                                      <button class="btn btn-light border-0" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                                          &#x22EE; <!-- Ï†ê 3Í∞ú ÏïÑÏù¥ÏΩò (ÏÑ∏Î°ú) -->
                                      </button>
                                      
                                      <!-- ÎìúÎ°≠Îã§Ïö¥ Î©îÎâ¥ -->
                                      <ul class="dropdown-menu shadow-sm border-0" aria-labelledby="dropdownMenuButton">
                                          <li>
                                              <a class="dropdown-item d-flex align-items-center text-danger" onclick="fn_delete_reply(\${reply.replyNo},\${element.boardNo})">
                                                  <span class="me-2">üóëÔ∏èÏÇ≠Ï†úÌïòÍ∏∞</span>
                                              </a>
                                          </li>
                                      </ul>
                                  </div>
                                  </div>
                              			
                              	`;
                              	
                              }
                              else{
                              	str+=`
                              		<div class="position-absolute top-1 end-0">
                              		<div class="dropdown">
                                      <!-- Ï†ê 3Í∞ú Î≤ÑÌäº -->
                                      <button class="btn btn-light border rounded-circle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                                          &#x22EE; <!-- Ï†ê 3Í∞ú ÏïÑÏù¥ÏΩò (ÏàòÏßÅ) -->
                                      </button>
                                      
                                      <!-- ÎìúÎ°≠Îã§Ïö¥ Î©îÎâ¥ -->
                                      <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                          <li>
                                              <a class="dropdown-item d-flex align-items-center" href="#">
                                                  <span class="me-2">üîî</span> Ïã†Í≥†ÌïòÍ∏∞
                                              </a>
                                          </li>
                                      </ul>
                                  </div>
                              	</div>		
                              	`;
                              } 
                              
                              str+=` <p id="repCreateDt">\${reply.repCreateDate}</p>
                                    <p class="mb-1">\${reply.replyContent}</p>
                                    <button class="btn btn-outline-danger" id="replyLikeBtn\${reply.replyNo}" onclick="fn_reply_likeYn(\${reply.boardNo}, \${reply.replyNo})">`;
                                    str+=`<i id="heartIcon\${reply.replyNo}" class="bi bi-heart`;
                                        $.each(reply.replyLikeList,function(idx,replyLike){
                                        	if(replyLike.memNo==memNo){
                                        		str+=`-fill`;
                                        		
                                        		} 
                                        });
                                       str+=`"></i>`;
                                    
                     str+=`       <span id="replyLikeCnt\${reply.replyNo}">\${reply.replyLikeCnt}</span></button>
                                </div>
                            </div></div>`;
                        	}});
                    }
      
                    

                    
                    
        str += `</div></div></div></div>`;
		}
    });
//Î≥∏Î¨∏ Î™©Î°ù

$("#divBoards").append(str);

}


$(function(){
	fn_board_list();

});	

//Ïä§ÌÅ¨Î°§ Î∞îÎã• Í∞êÏßÄ
window.onscroll = function(e) {	
    if((window.innerHeight + window.scrollY) >= document.body.offsetHeight) {
        if (!isLastPage) {  // ÎßàÏßÄÎßâ ÌéòÏù¥ÏßÄÍ∞Ä ÏïÑÎãàÎ©¥ ÌéòÏù¥ÏßÄ Ï¶ùÍ∞Ä
            currentPage += 1;
            console.log("currentPage:", currentPage);
            fn_board_list(currentPage, "");
        } else {
            console.log("Î™®Îì† Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨ÏôîÏäµÎãàÎã§.");
        }
    }
};


function readFile(input){
    var reader;
        console.log("input : ",input);
    for(var file of input.files){
        reader= new FileReader();
        reader.onload = function(e){
        	console.log(e);
            $("#editImg").attr("src",e.target.result);
        };
        console.log("dddd",reader);
        reader.readAsDataURL(input.files[0]);
    }
}




</script>
<%@ include file="../footer.jsp" %>
	<!-- Scroll Top -->
	<a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center active">
		<i class="bi bi-arrow-up-short"></i>
	</a>
	<!-- 	<i class="bi bi-arrow-up-short"></i> -->

<!-- Main JS File -->
<script src="/main/assets/js/main.js"></script>
</body>
</html>