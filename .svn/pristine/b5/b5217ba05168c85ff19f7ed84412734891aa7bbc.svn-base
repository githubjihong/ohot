<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ohot.shop.mapper.PaymentMapper">
	<insert id="ordersInsert" parameterType="com.ohot.shop.vo.OrdersVO">
		INSERT INTO orders (
			   order_no	
		     , mem_no
		     , gramt
		     , stlm_yn
		     , stlm_dt
		     , shipping_info_no
		) VALUES (
			   #{orderNo}
		     , #{memNo}
		     , #{gramt}
		     , #{stlmYn}
		     , SYSDATE
		     , #{shippingInfoNo}
		)
	</insert>
	
	<insert id="ordersDetailInsert" parameterType="com.ohot.shop.vo.OrdersVO" >
		<foreach collection="ordersDetailsVOList" item="ordersDetailsVO" open="INSERT ALL" close="SELECT * FROM DUAL" separator=" " index="idx" >
			INTO ORDERS_DETAILS(
				   gds_no
			   	 , order_no
			   	 , seq
			   	 , qty
			   	 , amount
			   	 , option1
			   	 , option2
			) VALUES (	  
				   #{ordersDetailsVO.gdsNo}
				 , #{ordersDetailsVO.orderNo}
				 , #{ordersDetailsVO.seq}
				 , #{ordersDetailsVO.qty} 
				 , #{ordersDetailsVO.amount}
				 , #{ordersDetailsVO.option1}
				 , #{ordersDetailsVO.option2}
			)
		</foreach>
	</insert>
	
	<!-- 회원의 주문번호 마지막을 가져오는 메소드 -->
	<select id="getLatestOrder" parameterType="com.ohot.vo.UsersVO" resultType="com.ohot.shop.vo.OrdersVO">
		SELECT ORDER_NO
		     , MEM_NO
		     , GRAMT
		     , STLM_YN
		     , STLM_DT
		     , SHIPPING_INFO_NO
		  FROM ORDERS
		 WHERE ORDER_NO = (SELECT MAX(ORDER_NO)
 			  				 FROM ORDERS
			 				WHERE MEM_NO = #{userNo})
	</select>
</mapper>