<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ohot.mapper.StatsMapper">

	<!-- 
	ex) 1번 아티스트의 2025년03월 일별통계
	 -->
	<select id="statsList" resultType="com.ohot.vo.StatsVO">
		SELECT SUBSTR(DM_STR_YMD, 1, 8) DM_STR_YMD
		     , COUNT(*) CNT
		FROM   DM_SUB 
		WHERE  ART_NO = 1
		AND    SUBSTR(DM_STR_YMD,1,6) = '202503'
		GROUP BY SUBSTR(DM_STR_YMD,1,8)
		ORDER BY 1
	</select> 
	
	<select id="listBarAjax" resultType="com.ohot.vo.StatsVO">
		SELECT TO_CHAR(REPLY_CREATE_DT, 'YYYYMMDD') AS REPLY_CREATE_DT,
		       COUNT(*) AS CNT2
		FROM   COMMUNITY_REPLY
		WHERE  TO_CHAR(REPLY_CREATE_DT, 'YYYY') = '2025'
		GROUP BY TO_CHAR(REPLY_CREATE_DT, 'YYYYMMDD')
		ORDER BY 1
	</select>
	
	<select id="listdoughnutAjax" resultType="com.ohot.vo.StatsVO">
		SELECT SUBSTR(TK_START_YMD, 1, 6) TK_START_YMD
		            , COUNT(*) CNT3
		FROM   TICKET
		WHERE  GDS_NO = 1
		AND    SUBSTR(TK_START_YMD, 1, 4) = '2025'
		GROUP BY SUBSTR(TK_START_YMD, 1, 6)
		ORDER BY 1
		
	</select>
	<select id="SubscriptionTotal" resultType="com.ohot.vo.StatsVO">
		SELECT SUM(CNT) AS TOTAL_CNT
		FROM (
		    SELECT SUBSTR(DM_STR_YMD, 1, 8) DM_STR_YMD
		         , COUNT(*) CNT
		    FROM   DM_SUB 
		    WHERE    SUBSTR(DM_STR_YMD, 1, 4) = '2025'
		    GROUP BY SUBSTR(DM_STR_YMD, 1, 8)
		)
		
	</select>
	<select id="memberTotal" resultType="com.ohot.vo.StatsVO">
		SELECT SUM(CNT) AS TOTAL_CNT2
		FROM (
		    SELECT SUBSTR(JOIN_YMD, 1, 8) JOIN_YMD
		         , COUNT(*) CNT
		    FROM   MEMBER 
		    WHERE    SUBSTR(JOIN_YMD, 1, 4) = '2025'
		    GROUP BY SUBSTR(JOIN_YMD, 1, 8)
		)
	</select>
	<select id="FollowersTotal" resultType="com.ohot.vo.StatsVO">
		SELECT COUNT(*) AS TOTAL_CNT3
 		 FROM FOLLOW_DETAIL
	</select>
	
	<select id="goodTotal" resultType="com.ohot.vo.StatsVO">
		 SELECT COUNT(*) AS TOTAL_CNT4
 		 FROM LIKE_DETAIL
	</select>
	
	<!-- 
	// 전체 글 수(검색 포함)
	public int getTotal(Map<String, Object> map);
	 -->
	 <select id="pazing" parameterType="hashMap" resultType="int">
	 	SELECT COUNT(*)
		  FROM MEMBER
		WHERE  1 = 1
		<if test="keyword!=null and keyword!=''">
			AND    MEM_LAST_NAME LIKE '%' || #{keyword} || '%'
		</if>
	 </select>
	 
	<!-- 회원가입 구독 통계 -->	 
	 <select id="listMemberAjax" resultType="com.ohot.vo.StatsVO">
		SELECT SUBSTR(JOIN_YMD, 1, 8) JOIN_YMD
		     , COUNT(*) MEMBER_CNT
		FROM   MEMBER 
		WHERE    SUBSTR(JOIN_YMD,1,6) = #{joinYmd}
		GROUP BY SUBSTR(JOIN_YMD,1,8)
		ORDER BY 1
	</select>
	<!-- 커뮤니티 구독 통계 -->
	<select id="communityMember" resultType="com.ohot.vo.StatsVO">
		  SELECT SUBSTR(COM_JOIN_YMD, 1, 6) COM_JOIN_YMD
		     , COUNT(*) COMPROFILECNT
		FROM   COMMUNITY_PROFILE 
		WHERE    SUBSTR(COM_JOIN_YMD,1,6) = '202503'
		GROUP BY SUBSTR(COM_JOIN_YMD,1,6)
		ORDER BY 1
        
	</select>
	
</mapper>