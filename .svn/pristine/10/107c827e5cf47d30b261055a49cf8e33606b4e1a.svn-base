<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<link rel="stylesheet" href="/shop/main.css" />
<title>Insert title here</title>
<style>
.btn-basic {
	color: #F86D72 !important;
	border-color: #F86D72 !important;
}

.btn:hover {
	background-color: #dee2e6 !important;
}

.required {
  color: red;
  font-weight: bold;
}
</style>

</head>
<body>
<!-- wrapper 시작 -->
  <div class="wrapper">
    <%@ include file="../../shopHeader.jsp" %>
    
    <!-- ✅ content 시작 -->
    <div class="content">
      <!-- Title -->
      <div class="container">
        <div class="card card-container-cart-title col-12">
          <h3 class="mt-5 mb-3">배송주소</h3>
        </div>
      </div>
        
      <div class="container">
	    <div class="row">
          <div class="card card-container">	
            <!-- card body --> 
            <div class="card-body card-body-container p-3">
              <div class="col-12 text-start">
                <!-- 배송 목록 출력 -->
                <c:forEach var="shippingInfoVO" items="${shippingInfoVOList}" >
                  <div class="d-flex justify-content-between align-items-center">
                    <h5 class="card-title fw-bold">${shippingInfoVO.farstNm}${shippingInfoVO.lastNm}</h5>
                    <!-- 버튼 묶기 -->
    			    <div class="d-flex gap-2">
                  	  <input type="hidden" value="${shippingInfoVO.shippingInfoNo}">
                      <button type="button" class="btn btn-outline-primary btn-basic btn-single-row">
				  		수정
					  </button>
                      <button type="button" class="btn btn-outline-primary btn-basic delete">
				  	    삭제
					  </button>
                    </div>
                  </div>
                  <h6 class="card-title">${shippingInfoVO.addressNm}${shippingInfoVO.addressDetNm}</h6>
                  <h6 class="card-title">${shippingInfoVO.country}</h6>
                  <h6 class="card-title">${shippingInfoVO.telNo}</h6>
			      <hr/>
			    </c:forEach>
              <!-- footer 영역 영역 -->
              <div class="d-flex justify-content-between align-items-center mt-3">
                <span>배송 주소는 최대 10개까지 등록할 수 있습니다.</span>
                <!-- Button trigger modal -->
				<button type="button" class="btn btn-outline-primary btn-basic" data-bs-toggle="modal" data-bs-target="#exampleModal">
				  등록
				</button>
              </div>	
            </div>
          </div>
	    </div>
        </div>
      </div>
    
    </div><!-- content 종료 --> 
    <%@ include file="../../shopfooter.jsp" %>
  </div><!-- wrapper 영역 종료 -->
  
<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
	  <div class="modal-header">
	    <h1 class="modal-title fs-5" id="exampleModalLabel">배송 주소 등록</h1>
	    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	  </div>
	
	  <form id="addr">
        <div class="modal-body" id="modalBody">
          <div class="mb-3">
            <label for="recipient-name" class="form-label">성<span class="required">*</span></label>
            <input type="text" class="form-control" id="farstNm" name="farstNm" placeholder="성 입력" value="abc">
          </div>
        
          <div class="mb-3">
            <label for="recipient-name" class="form-label">이름<span class="required">*</span></label>
            <input type="text" class="form-control" id="lastNm" name="lastNm" placeholder="이름 입력" value="abc">
          </div>
        
          <div class="mb-3">
            <label for="recipient-name" class="form-label">전화번호<span class="required">*</span></label>
            <input type="text" class="form-control" id="telno" name="telno" placeholder="전화번호 입력" value="111">
          </div>
      
          <div class="mb-3">
            <label for="recipient-name" class="form-label">배송국가<span class="required">*</span></label>
            <input type="text" class="form-control" id="country" name="country" placeholder="배송국가지역" value="abc">
          </div>
        
          <div class="mb-3">
            <label for="recipient-name" class="form-label">배송국가코드<span class="required">*</span></label>
            <input type="text" class="form-control" id="countryCd" name="countryCd" placeholder="배송국가코드" value="111">
          </div>
        
          <div class="mb-3">
            <label for="recipient-name" class="form-label">우편번호<span class="required">*</span></label>
            <input type="text" class="form-control" id="zipCd" name="zipCd" placeholder="우편번호" value="111">
          </div>
      
           <div class="mb-3">
            <label for="recipient-name" class="form-label">기본주소<span class="required">*</span></label>
            <input type="text" class="form-control" id="addressNm" name="addressNm" placeholder="기본주소" value="abc">
          </div>
      
          <div class="mb-3">
            <label for="recipient-name" class="form-label">상세주소<span class="required">*</span></label>
            <input type="text" class="form-control" id="addressDetNm" name="addressDetNm" placeholder="상세주소" value="abc">
          </div>
          
          <!-- 모달 푸터 -->
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
            <button type="button" class="btn btn-primary" id="save">저장</button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
</body>

<!-- JS 영역 -->
<script type="text/javascript">

$("#save").on('click', function(){
	fetch('/shop/addrManagerPost', {
		method: "post",
		headers: {
			"Content-Type": "application/x-www-form-urlencoded",
		},
		body: $("#addr").serialize()
	}).then( (resp)=> {
		resp.text().tehn( (rslt)=> {
			console.log(rslt)
		})	
	})
	
})

// modal 창 버튼이 새로 생성되었을 떄 동적으로바인딩!
$('#modalBody').on('click', '#update' ,function(){
	
	fetch('/shop/addrManagerUpdatePost', {
		method: "POST",
		headers: {
			"Content-Type": "application/x-www-form-urlencoded",
		},
		body: $("#addr").serialize()
	}).then( (resp)=> {
		resp.text().tehn( (rslt)=> {
			console.log(rslt)
		})	
	})
})

$('.delete').on('click', function(){
	let shippingInfoNo = $(this).closest('div').find('input').eq(0).val();
	console.log(shippingInfoNo);
	
	
	shippingInfoVO = {
	  "shippingInfoNo" : shippingInfoNo
	}
			
	fetch('/shop/addrManagerDeletePost', {
		method: "POST",
		headers: {
			"Content-Type": "application/json;charset=UTF-8",
		},
		body: JSON.stringify(shippingInfoVO)
	}).then( (resp)=> {
		resp.text().then( (rslt)=> {
			console.log("삭제되었습니다!");
		})	
	})
})

$(".btn-single-row").on('click', function(){
	
	let shippingInfoNo = $(this).closest('div').find('input').eq(0).val();
	
	console.log(shippingInfoNo);
	
	shippingInfoVO = {
	  "shippingInfoNo" : shippingInfoNo
	}
	
	fetch('/shop/addrManagerUpdateForm', {
		method: "POST",
		headers: {
			"Content-Type": "application/json;charset=UTF-8",
		},
		body: JSON.stringify(shippingInfoVO)
	}).then( (resp)=> {
		resp.json().then( (rslt)=> {
			console.log(rslt)
			
			let modalbody = document.getElementById('modalBody');
			
			console.log(modalbody);
			
			modalbody.innerHTML = "";
			
			modalbody.innerHTML = `
			  <input type="hidden" name="shippingInfoNo" value="\${shippingInfoVO.shippingInfoNo}">
			  <div class="mb-3">
	            <label for="recipient-name" class="form-label">성<span class="required">*</span></label>
	            <input type="text" class="form-control" id="farstNm" name="farstNm" placeholder="성 입력" value="\${rslt.farstNm}">
	          </div>
	        
	          <div class="mb-3">
	            <label for="recipient-name" class="form-label">이름<span class="required">*</span></label>
	            <input type="text" class="form-control" id="lastNm" name="lastNm" placeholder="이름 입력" value="\${rslt.lastNm}">
	          </div>
	        
	          <div class="mb-3">
	            <label for="recipient-name" class="form-label">전화번호<span class="required">*</span></label>
	            <input type="text" class="form-control" id="telNo" name="telNo" placeholder="전화번호 입력" value="\${rslt.telNo}">
	          </div>
	      
	          <div class="mb-3">
	            <label for="recipient-name" class="form-label">배송국가<span class="required">*</span></label>
	            <input type="text" class="form-control" id="country" name="country" placeholder="배송국가지역" value="\${rslt.country}">
	          </div>
	        
	          <div class="mb-3">
	            <label for="recipient-name" class="form-label">배송국가코드<span class="required">*</span></label>
	            <input type="text" class="form-control" id="countryCd" name="countryCd" placeholder="배송국가코드" value="111">
	          </div>
	        
	          <div class="mb-3">
	            <label for="recipient-name" class="form-label">우편번호<span class="required">*</span></label>
	            <input type="text" class="form-control" id="zipCd" name="zipCd" placeholder="우편번호" value="\${rslt.zipCd}">
	          </div>
	      
	           <div class="mb-3">
	            <label for="recipient-name" class="form-label">기본주소<span class="required">*</span></label>
	            <input type="text" class="form-control" id="addressNm" name="addressNm" placeholder="기본주소" value="\${rslt.addressNm}">
	          </div>
	      
	          <div class="mb-3">
	            <label for="recipient-name" class="form-label">상세주소<span class="required">*</span></label>
	            <input type="text" class="form-control" id="addressDetNm" name="addressDetNm" placeholder="상세주소" value="\${rslt.addressDetNm}">
	          </div>
	          
	          <!-- 모달 푸터 -->
	          <div class="modal-footer">
	            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
	            <button type="button" class="btn btn-primary" id="update">저장</button>
	          </div>
			`
			
			$('#exampleModal').modal('show');
			
		})	
	})
})


</script>


</html>