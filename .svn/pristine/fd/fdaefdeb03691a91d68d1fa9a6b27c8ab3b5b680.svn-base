package com.ohot.admin.controller;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.multipart.MultipartFile;

import com.ohot.service.ArtistGroupService;
import com.ohot.service.ArtistService;
import com.ohot.util.BoardPage;
import com.ohot.vo.ArtistGroupVO;
import com.ohot.vo.ArtistVO;

import lombok.extern.slf4j.Slf4j;

@Slf4j
@Controller("adminArtistController")
@RequestMapping("/admin/artistGroup")
public class ArtistGroupController {

	@Autowired
	ArtistGroupService artistGroupService;
	
	@Autowired
	ArtistService artistService;
	
	// /admin/artistGroup/artistGroupList?mode=artGroupNm&keyword=스테이씨
	@GetMapping("/artistGroupList")
	public String artistGroupList(
			Model model, 
			@RequestParam(value="mode", required = false, defaultValue = "") String mode,
			@RequestParam(value="keyword", required = false, defaultValue = "") String keyword,
			@RequestParam(value="currentPage", required = false, defaultValue = "1") int currentPage) {
		
		int size = 5;
		
		Map<String, Object> map = new HashMap<String, Object>();
		map.put("mode", mode);
		map.put("keyword", keyword);
		map.put("currentPage", currentPage);
		map.put("size", size);
		
		int total = this.artistGroupService.getTotalArtistGroup(map);
		
		List<ArtistGroupVO> artistGroupVOList = this.artistGroupService.artistGroupList(map);
		
		BoardPage<ArtistGroupVO> boardPage = new BoardPage<>(total, currentPage, size, keyword, artistGroupVOList, mode);
		log.info("artistGroupList->boardPage : " + boardPage);
		
		model.addAttribute("boardPage", boardPage);
		
		return "admin/artistGroup/artistGroupList"; 
	}
	
	@GetMapping("/artistGroupDetail")
	public String artistGroupDetail(Model model, ArtistGroupVO artistGroupVO) {
		/*
		ArtistGroupVO(artGroupNo=5, artGroupDebutYmd=null, artGroupNm=null,..)
		 */
		log.info("artistGroupDetail->artistGroupDetail(전) : " + artistGroupVO);
		
		ArtistGroupVO artistGroupDetail = this.artistGroupService.artistGroupDetail(artistGroupVO);
		/*
		ArtistGroupVO(artGroupNo=5, artGroupDebutYmd=null, artGroupNm=null, artGroupExpln=null, 
		artGroupRegYmd=null, artGroupDelYn=null, fileGroupNo=0, fileGroupVO=null, uploadFile=null)
		 */
		log.info("artistGroupDetail->artistGroupDetail(후) : " + artistGroupVO);
		
		model.addAttribute("artistGroupDetail", artistGroupDetail);
		log.info("artistGroupDetail : " + artistGroupDetail);
		
		return "admin/artistGroup/artistGroupDetail";
	}
	
	@GetMapping("/artistGroupRegister")
	public String register(ArtistGroupVO artistGroupVO) {
		
		return "admin/artistGroup/artistGroupRegisterPost";
		
	}
	
	@PostMapping("/artistGroupRegisterPost")
	public String registerPost(ArtistGroupVO artistGroupVO,
			@RequestParam(value="uploadFile") MultipartFile[] uploadFile) {
		
		artistGroupVO.setUploadFile(uploadFile);
		
		int result = this.artistGroupService.artistGroupInsert(artistGroupVO);
		log.info("artistGroupRegisterPost->artistGroupInsert : "+ result);
		
		return "redirect:/admin/artistGroup/artistGroupDetail?artGroupNo="+artistGroupVO.getArtGroupNo();
		
	}
	
	@GetMapping("/artistGroupEdit")
	public String edit(Model model, ArtistGroupVO artistGroupVO) {
		
		ArtistGroupVO artistGroupDetail = this.artistGroupService.artistGroupDetail(artistGroupVO);
		
		model.addAttribute("artistGroupDetail", artistGroupDetail);
		
		List<ArtistVO> artistVOList = this.artistService.artistList();
		
		model.addAttribute("artistVOList", artistVOList);
		
		return "admin/artistGroup/artistGroupEdit";
	}
	
	@PostMapping("/artistGroupEditPost")
	public String editPost(Model model, ArtistGroupVO artistGroupVO,
			@RequestParam(value="uploadFile") MultipartFile[] uploadFile) {
		

		artistGroupVO.setUploadFile(uploadFile);
		
		int result = this.artistGroupService.artistGroupUpdate(artistGroupVO);
		log.info("artistGroupEditPost->editPost : "+ result);
	
		
		return "redirect:/admin/artistGroup/artistGroupDetail?artGroupNo="+artistGroupVO.getArtGroupNo();
	}
	
	
}
