package com.ohot.security;

import java.io.IOException;

import org.springframework.security.core.AuthenticationException;
import org.springframework.security.web.AuthenticationEntryPoint;

import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

public class CustomAuthenticationEntryPoint implements AuthenticationEntryPoint{

	@Override
	public void commence(HttpServletRequest request, HttpServletResponse response,
			AuthenticationException authException) throws IOException, ServletException {
		
		// 현재 요청 URI 가져오기
		String requestURI = request.getRequestURI();
		
		// 이동할 URL을 결정
	    String redirectUrl;
	    
	    if (requestURI.startsWith("/oho")) {
	        redirectUrl = "/login";
	    } else if (requestURI.startsWith("/shop")) {
	        redirectUrl = "/login";
	    } else if (requestURI.startsWith("/emp")) {
	    	redirectUrl = "/emp/login";
	    } else if (requestURI.startsWith("/admin")) {
	    	redirectUrl = "/admin/login";
	    } else {
	        redirectUrl = "/login";
	    }
		
		// JS alert 후 로그인 페이지로 이동
        response.setContentType("text/html;charset=UTF-8");
        response.getWriter().write(
            "<script>" +
            "alert('로그인이 필요합니다!');" +
            "location.href='" + redirectUrl + "';" +
            "</script>"
        );
	}

}
