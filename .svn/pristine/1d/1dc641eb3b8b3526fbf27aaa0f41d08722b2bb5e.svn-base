package com.ohot.admin.service.impl;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.web.multipart.MultipartFile;

import com.ohot.admin.mapper.AdminGoodsMapper;
import com.ohot.admin.service.AdminGoodsService;
import com.ohot.shop.vo.GoodsVO;
import com.ohot.shop.vo.TicketVO;
import com.ohot.shop.vo.TkDetailVO;
import com.ohot.util.UploadController;
import com.ohot.vo.FileDetailVO;
import com.ohot.vo.FileGroupVO;

@Service
public class AdminGoodsServiceImpl implements AdminGoodsService {
	
	@Autowired
	AdminGoodsMapper adminGoodsMapper;
	
	@Autowired
	UploadController uploadController;
	

	@Override
	public int ticketInsert(GoodsVO goodsVO, MultipartFile[] uploadFiles) {

		long fileGroupNo=this.uploadController.multiImageUpload(uploadFiles);
		
		goodsVO.setFileGroupNo(fileGroupNo);
		
		this.adminGoodsMapper.goodsInsert(goodsVO);
		
		
		TicketVO ticketVO = goodsVO.getTicketVO();
        ticketVO.setGdsNo(goodsVO.getGdsNo());  // 외래키 설정
        this.adminGoodsMapper.ticketInsert(ticketVO);  // Ticket INSERT
		
		return this.adminGoodsMapper.ticketInsert(ticketVO);
	}

	@Override
	public List<GoodsVO> ticketList() {
		// TODO Auto-generated method stub
		return this.adminGoodsMapper.ticketList();
	}


	@Override
	public FileDetailVO ticketPoster(MultipartFile[] uploadFile) {
		MultipartFile[] multipartFiles = uploadFile;

		long fileGroupNo = this.uploadController.multiImageUpload(multipartFiles);
		// 호출

		return this.adminGoodsMapper.ticketPosterImg(fileGroupNo);

	}

	@Override
	public FileDetailVO ticketPosterImg(long fileGroupNo) {
		// TODO Auto-generated method stub
		return null;
	}

	@Override
	public long tkDetailInsert(TkDetailVO tkDetailVO) {
		// TODO Auto-generated method stub
		return this.adminGoodsMapper.tkDetailInsert(tkDetailVO.getTkNo());
	}

}
