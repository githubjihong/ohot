package com.ohot.home.inquiry.service.impl;

import java.util.List;
import java.util.Map;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import com.ohot.home.inquiry.mapper.InquiryPostMapper;
import com.ohot.home.inquiry.service.InquiryPostService;
import com.ohot.home.inquiry.vo.InquiryTypeVO;
import com.ohot.vo.BoardPostVO;

@Service
public class InquiryPostServiceImpl implements InquiryPostService{

	@Autowired
	InquiryPostMapper inquiryPostMapper;
	
	// 전체 문의글 리스트
	@Override
	public List<BoardPostVO> getInquiryPostList(Map<String, Object> map) {
		return this.inquiryPostMapper.getInquiryPostList(map);
	}

	// 토탈 카운트
	@Override
	public int getTotalCnt(Map<String, Object> map) {
		return this.inquiryPostMapper.getTotalCnt(map);
	}

	// 게시글 상세 (답글이 있으면 추가해 줌)
	@Transactional
	@Override
	public BoardPostVO getInquiryDetail(int boardNo) {
		BoardPostVO inquiryPost = this.inquiryPostMapper.getInquiryDetail(boardNo);
		BoardPostVO replyPost = this.inquiryPostMapper.getReplyPost(boardNo);
		
		if(replyPost != null) {
			inquiryPost.setReplyPostVO(replyPost);
		}
		
		return inquiryPost;
	}

	// 기본키 최대값 구하기
	@Override
	public int getMaxNo() {
		return this.inquiryPostMapper.getMaxNo();
	}

	// 게시판 명 불러오기
	@Override
	public List<InquiryTypeVO> getInqTypeVO() {
		return this.inquiryPostMapper.getInqTypeVO();
	}

	// 문의게시글 작성 시 BoardPost 테이블 insert
	@Transactional
	@Override
	public int insertBoardPost(Map<String, Object> map) {
		int result = this.inquiryPostMapper.insertBoardPost(map);
		if(result == 1) {
			// 문의게시글 작성 시 InquiryPost 테이블 insert
			result += this.inquiryPostMapper.insertInquiryPost(map);
		}
		return result;
	}

	// 문의게시글 수정 시 BoardPost테이블 update
	@Transactional
	@Override
	public int editBoardPost(Map<String, Object> map) {
			int result = this.inquiryPostMapper.editBoardPost(map);
			if(result == 1) {
				result += this.inquiryPostMapper.editInquiryPost(map);
			}
		return result;
	}

	// 게시글 삭제
	@Override
	public int deletePost(int bbsPostNo) {
		return this.inquiryPostMapper.deletePost(bbsPostNo);
	}

}
