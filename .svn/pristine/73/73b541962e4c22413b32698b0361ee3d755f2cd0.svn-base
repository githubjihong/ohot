
const blockSize = 10;

	// ë Œë”ë§ ë  ë•Œ ì‹¤í–‰
	fn_search(1);
	

	// ì´ˆê¸°í™” ë²„íŠ¼ ëˆŒë €ì„ ë•Œ
	const btnReset = document.getElementById("btnReset");
	btnReset.addEventListener("click", () => {
		fn_reset();
	})
	
	// ê²€ìƒ‰ë²„íŠ¼ ëˆŒë €ì„ ë•Œ
	const btnSearch = document.getElementById("btnSearch");
	btnSearch.addEventListener("click", ()=> {
		fn_search(1);
	});
	
	function fn_search(page) {
		const inqType = document.getElementById("inqType");
		const mode = document.getElementById("mode");
		const keyword = document.getElementById("keyword");
		console.log("pageê°€ ë­˜ê¹Œìš” : ", page);
		console.log("inqTypeê°€ ë­˜ê¹Œìš” : ", inqType.value);
		console.log("modeê°€ ë­˜ê¹Œìš” : ", mode.value);
		console.log("keywordê°€ ë­˜ê¹Œìš” : ", keyword.value);
		
		const params = {
			mode : mode.value,
			keyword : keyword.value,
			inqTypeNo : inqType.value,
	 		page : page,
	 		blockSize : blockSize,
	 		start : (page - 1) * blockSize + 1,
	 		end : page * 10
	 	}
		
		console.log("params ì²´í¬ : ", params);
		
		axios.get("/oho/inquiryPost/getListAjax", { params }).then(resp => {
			console.log("ì•„ì‘ìŠ¤ ê²°ê³¼ : ", resp.data);
			
			const { content, currentPage, totalPages, startPage, endPage } = resp.data;
			renderTable(content);
			renderPagination({currentPage, totalPages, startPage, endPage});
		})
	}
	
	function renderTable(data) { 
		
		console.log("renderTable ì‹¤í–‰ : ", data);
		const tbody = document.getElementById("listBody");
		tbody.innerHTML = "";
		
		let html = ``;
			
		if(data.length == 0) {
			html += `
				<tr>
					<th colspan="6" class="empty-row">ë“±ë¡ëœ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</th>
				</tr>
			`
		} else {

			data.forEach(board => {
				console.log("board : ", board);
				
				const inqWriter = board.inquiryPostVO.inqWriter;
				
				html += `
					  <tr style="height: 60px;" class="align-middle">
				      <th scope="row" class="col-1">${board.rnum}</th>
				      <th class="col-2" style="text-align: left;">${board.inquiryPostVO.inqTypeNm}</th>
				      <td class="col-5" onclick="fn_clickPost(${board.bbsPostNo}, ${board.inquiryPostVO.inqPswd})" style="cursor:pointer; color:black; text-align: left;">
					  	${board.bbsTitle}
					  </td>
				      <td  class="col-2" style="text-align: left;">${inqWriter}</td>
				      <td  class="col-1">${board.bbsRegYmd}</td>
					`;
				
				if(board.inquiryPostVO.inqPswd != null ) {
					html += `<td class="col-1">ğŸ”’</td>`;
				}else {
					html += `<td class="col-1">ğŸ”“</td>`;
				}
				
				html += `</tr>`;
				
			})
		}
			tbody.innerHTML = html;
		
	}

function renderPagination(paging) {
	console.log("renderPaginationì‹¤í–‰ data: ", paging);
	
	const container = document.getElementById("pagination-container");
	container.innerHTML = "";
	
	if (!paging || paging.totalPages === 0) {
		return;
	}
	
	const totalPages = paging.totalPages;
	let startPage = Math.floor((paging.currentPage - 1) / blockSize) * blockSize + 1;
	let endPage = startPage + blockSize - 1;
	console.log("totalPages : ", totalPages);
	console.log("startPage : ", startPage);
	console.log("endPage : ", endPage);

	if (endPage > totalPages) {
		endPage = totalPages;
	}

	let html = '<ul class="pagination">';

	const disabledFirst = startPage <= 1 ? 'disabled' : '';
	const disabledLast = endPage >= totalPages ? 'disabled' : '';

	html += `<li class="page-item ${disabledFirst}">
	          <a class="page-link" href="javascript:void(0)" onclick="fn_search(1); return false;"><<</a></li>`;
	html += `<li class="page-item ${disabledFirst}">
	          <a class="page-link" href="javascript:void(0)" onclick="fn_search(${paging.currentPage - 1}); return false;"><</a></li>`;

	for (let i = startPage; i <= endPage; i++) {
		const active = i === paging.currentPage ? 'active' : '';
		html += `<li class="page-item ${active}">
	              <a class="page-link" href="javascript:void(0)" onclick="fn_search(${i}); return false;">${i}</a></li>`;
	}

	html += `<li class="page-item ${disabledLast}">
	          <a class="page-link" href="javascript:void(0)" onclick="fn_search(${endPage + 1}); return false;">></a></li>`;
	html += `<li class="page-item ${disabledLast}">
	          <a class="page-link" href="javascript:void(0)" onclick="fn_search(${totalPages}); return false;">>></a></li>`;

	html += '</ul>';

	container.innerHTML = html;
		
}

/* ê²€ìƒ‰í•„í„° ì´ˆê¸°í™” ë²„íŠ¼ */
function fn_reset() {
	
	document.getElementById("srhFrm").reset();
	fn_search(1);

}

//ê²Œì‹œê¸€ì„ ëˆŒë €ì„ ë•Œ
function fn_clickPost(postNo, pswd) {
	console.log("ê²Œì‹œê¸€ ë²ˆí˜¸ : ", postNo);
	console.log("ë¹„ë°€ë²ˆí˜¸ : ", pswd);
	
	if(pswd != null ) { // ë¹„ë°€ê¸€ì¼ ê²½ìš°
		// ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ëª¨ë‹¬ì°½ ì—´ê¸°
		const pswdModal =	document.getElementById("pswdModal");
		pswdModal.style.display = "flex";
		
		// ì…ë ¥ë²„íŠ¼ í´ë¦­í–ˆì„ ê²½ìš°
		const nextBtn = document.getElementById("nextBtn");
		nextBtn.addEventListener("click", () => {
			console.log("ì…ë ¥ë²„íŠ¼ í´ë¦­");
			const inputPswd = document.getElementById("inputPswd");
			if(inputPswd.value == pswd) { // ì¼ì¹˜
				location.href='/oho/inquiryPost/detail?boardNo='+postNo;
			}else { // ë¶ˆì¼ì¹˜
				failAlert();
			}
		})
		
	}else{ // ê³µê°œê¸€ì¼ ê²½ìš°
		location.href='/oho/inquiryPost/detail?boardNo='+postNo;
	}
}

// ë¹„ë°€ë²ˆí˜¸ í† ê¸€
function togglePassword(iconSpan) {
	const input = iconSpan.parentElement.querySelector('input');
	const eyeIcon = iconSpan.querySelector('i');

	if (input.type === "password") {
		input.type = "text";
		eyeIcon.classList.remove("fa-eye-slash");
		eyeIcon.classList.add("fa-eye");
	} else {
		input.type = "password";
		eyeIcon.classList.remove("fa-eye");
		eyeIcon.classList.add("fa-eye-slash");
	}
}

// ì·¨ì†Œ ë²„íŠ¼ ì„ ëˆŒë €ì„ ë•Œ
const cancelBtn = document.getElementById("cancelBtn");
cancelBtn.addEventListener("click", function(e) {
 		 pswdModal.style.display = "none";
 		 newPw.value = "";
    });
	
